{"version":3,"file":"index.tsx","sources":["../node_modules/tslib/tslib.es6.js","../node_modules/style-inject/dist/style-inject.es.js","../src/components/Tab.tsx","../src/lib/color.ts","../src/lib/utils.ts","../src/components/Attributes.tsx","../src/lib/create-context-provider.tsx","../src/contexts/text-viewer.context.ts","../src/components/AnnotationDetail.tsx","../src/components/LinkDetail.tsx","../src/components/LegendList.tsx","../src/components/TextDetail.tsx","../src/lib/text-spacer.ts","../src/components/Annotation.tsx","../src/components/LinkSingleLine.tsx","../src/components/LinkMultiLine.tsx","../src/components/AnnotationLabel.tsx","../src/components/LineWithArrow.tsx","../src/components/LinkEditConnector.tsx","../src/components/TextArea.tsx","../src/components/ScopeSelector.tsx","../src/components/LinkCreateBox.tsx","../src/components/AnnotationCreateBox.tsx","../src/components/TextViewer.tsx","../src/lib/log.ts","../src/lib/transform.ts","../src/index.tsx"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from) {\r\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\r\n        to[j] = from[i];\r\n    return to;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import React, {useState} from 'react';\nimport style from '../styles/Tab.module.css';\n\ntype RenderFn = () => JSX.Element;\n\nexport interface ITabItem {\n  title: string | RenderFn;\n  body: RenderFn;\n}\n\nexport interface TabProp {\n  tabs: ITabItem[];\n  activeTabIndex?: number;\n}\n\nexport default function Tab({tabs, activeTabIndex}: TabProp) {\n  const [state, setState] = useState(activeTabIndex || 0);\n\n  return (\n    <div className={style.tab_container}>\n      <div className={style.tab_header}>\n        {tabs.map((tab, i) => {\n          const isSelected = i === state;\n          return (\n            <div\n              key={i}\n              className={`${style.tab_header_button} ${\n                isSelected ? style.tab_header_button_selected : ''\n              }`}\n              onClick={() => {\n                setState(i);\n              }}\n            >\n              {typeof tab.title === 'string' ? tab.title : tab.title()}\n            </div>\n          );\n        })}\n      </div>\n\n      <div className={style.tab_body}>\n        {tabs[state] ? tabs[state].body() : null}\n      </div>\n    </div>\n  );\n}\n","// https://css-tricks.com/snippets/javascript/lighten-darken-color/\nexport function lightenDarkenColor(col: string, amt: number) {\n  let usePound = false;\n\n  if (col[0] === '#') {\n    col = col.slice(1);\n    usePound = true;\n  }\n\n  const num = parseInt(col, 16);\n\n  let r = (num >> 16) + amt;\n\n  if (r > 255) r = 255;\n  else if (r < 0) r = 0;\n\n  let b = ((num >> 8) & 0x00ff) + amt;\n\n  if (b > 255) b = 255;\n  else if (b < 0) b = 0;\n\n  let g = (num & 0x0000ff) + amt;\n\n  if (g > 255) g = 255;\n  else if (g < 0) g = 0;\n\n  return (usePound ? '#' : '') + (g | (b << 8) | (r << 16)).toString(16);\n}\n\nexport const colorPalettes = [\n  '#099AEB', // 1\n  '#FCB527', // 2\n  '#00BFA4', // 3\n  '#FF9961', // 4\n  '#52BA52', // 5\n  '#F26DCC', // 6\n  '#38D8F7', // 7\n  '#0776BA', // 8\n  '#E47700', // 9\n  '#00BFA4', // 10\n  '#FF5B00', // 11\n  '#20822B', // 12\n  '#D3279F', // 13\n  '#09BEE2', // 14\n  '#05588D', // 15\n  '#BD5800', // 16\n  '#00BFA4', // 17\n  '#D63D00', // 18\n  '#16491C', // 19\n  '#A51B88', // 20\n  '#068098', // 21\n  '#014439', // 22\n  '#971900', // 23\n  '#72145E', // 24\n];\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  IEntryDefinition,\n  ILinkWithPos,\n  ISinglePack,\n  IOntology,\n  ILegendConfigs,\n  IScopeConfigs,\n} from './interfaces';\nimport {colorPalettes} from './color';\n\nexport function applyColorToLegend(\n  legends: IEntryDefinition[]\n): (IEntryDefinition & {color: string})[] {\n  return legends.map((leg, i) => {\n    return {\n      ...leg,\n      color: colorPalettes[i % colorPalettes.length],\n    };\n  });\n}\n\nexport function displayAttributeInline(attr_value: any) {\n  const attr_type: string = typeof attr_value;\n\n  // The way that we display null value and other objects will leave an empty box.\n  // We can probably use the ontology to filter out some of these.\n\n  if (attr_type === 'boolean') {\n    return attr_value.toString();\n  } else if (attr_type === 'string') {\n    return attr_value.substring(0, 3);\n  } else if (attr_type === 'number') {\n    return attr_value.toString();\n  } else if (attr_value === null) {\n    return '';\n  } else {\n    return '-';\n  }\n}\n\nexport function displayAttributeFloating(attr_value: any) {\n  const attr_type: string = typeof attr_value;\n\n  if (attr_type === 'boolean') {\n    return attr_value.toString();\n  } else if (attr_type === 'string') {\n    return attr_value.substring(0, 3);\n  } else if (attr_type === 'number') {\n    return attr_value.toString();\n  } else if (attr_value === null) {\n    return 'N/A';\n  } else {\n    return 'complex object';\n  }\n}\n\nexport function displayAttributeSidebar(attr_value: any) {\n  const attr_type: string = typeof attr_value;\n\n  if (attr_type === 'boolean') {\n    return attr_value.toString();\n  } else if (attr_type === 'string') {\n    return attr_value.substring(0, 3);\n  } else if (attr_type === 'number') {\n    return attr_value.toString();\n  } else if (attr_value === null) {\n    return 'N/A';\n  } else {\n    return 'complex object';\n  }\n}\n\nexport function notNullOrUndefined<T>(x: T | null | undefined): x is T {\n  return x !== null && x !== undefined;\n}\n\n/**\n\n{\n    321: [ // line at position 321\n        ...\n        [linkPos1, linkPos2], // level n\n        [linkPos3], // lower then level n\n        ...\n    ],\n    ...\n}\n\n */\nexport function calculateLinesLevels(\n  linksWithPos: ILinkWithPos[],\n  lineStartX: number,\n  lineWidth: number\n): Record<string, ILinkWithPos[][]> {\n  const lineMap: any = {};\n  linksWithPos.forEach(link => {\n    if (link.fromLinkY === link.toLinkY) {\n      lineMap[link.fromLinkY] = lineMap[link.fromLinkY] || [];\n      lineMap[link.fromLinkY].push(link);\n    } else {\n      const goLeft = shouldMultiLineGoLeft(link, lineStartX, lineWidth);\n      lineMap[link.fromLinkY] = lineMap[link.fromLinkY] || [];\n      lineMap[link.fromLinkY].push({\n        ...link,\n        toLinkY: link.fromLinkY,\n        toLinkX: goLeft ? lineStartX : lineStartX + lineWidth,\n      });\n\n      lineMap[link.toLinkY] = lineMap[link.toLinkY] || [];\n      lineMap[link.toLinkY].push({\n        ...link,\n        fromLinkY: link.toLinkY,\n        fromLinkX: goLeft ? lineStartX : lineStartX + lineWidth,\n      });\n    }\n  });\n\n  Object.keys(lineMap).forEach(key => {\n    lineMap[key] = calculateLevelForSingleLine(lineMap[key]);\n  });\n\n  return lineMap;\n\n  /**\n   *\n   * go through each level from top\n   * - if no overlap with any link in current lavel, push to same level\n   * - if there is overlap but only super set, insert a level above, and push to it\n   * - if reach the end, insert a new level below then push to it\n   * - otherwise, check lower level.\n   *\n   * after levels is build\n   * - project each link down into lower levels\n   *\n   */\n  function calculateLevelForSingleLine(\n    links: ILinkWithPos[]\n  ): ILinkWithPos[][] {\n    const levels: ILinkWithPos[][] = [];\n    links.forEach(link => {\n      let insertLevel = -1;\n      let pushLevel = -1;\n      for (let i = 0; i < levels.length; i++) {\n        let shouldBreak = false;\n        let shouldContinue = false;\n        switch (checkLevelOverlap(link, levels[i])) {\n          case 'superset':\n            insertLevel = i;\n            shouldBreak = true;\n            break;\n          case 'no-overlap':\n            pushLevel = i;\n            shouldBreak = true;\n            break;\n          case 'subset':\n          case 'intersect':\n            shouldContinue = true;\n            break;\n        }\n        if (shouldBreak) break;\n        if (shouldContinue) continue;\n      }\n\n      if (insertLevel !== -1) {\n        levels.splice(insertLevel, 0, [link]);\n      } else if (pushLevel !== -1) {\n        levels[pushLevel].push(link);\n      } else {\n        levels.push([link]);\n      }\n    });\n\n    projectDownLinksInLevels(levels);\n    return levels.filter(l => l.length);\n  }\n\n  // go through each level from bottom to top\n  // - if the link can be push down, move the link to the lower level, until it can't\n  //   - to check if the link can be push down, check lower level has intercepts.\n  function projectDownLinksInLevels(levels: ILinkWithPos[][]) {\n    for (let i = levels.length - 2; i >= 0; i--) {\n      const level = levels[i];\n      const linkstoProject: number[][] = [];\n\n      for (let j = 0; j < level.length; j++) {\n        const link = level[j];\n        let levelToProject = -1;\n        for (let k = i + 1; k < levels.length; k++) {\n          if (checkLevelOverlap(link, levels[k]) === 'no-overlap') {\n            levelToProject = k;\n          } else {\n            break;\n          }\n        }\n        if (levelToProject !== -1) {\n          linkstoProject.push([j, levelToProject]);\n        }\n      }\n\n      levels[i] = level.filter(\n        (_, i) => linkstoProject.map(l => l[0]).indexOf(i) === -1\n      );\n      linkstoProject.forEach(([linkIndex, levelIndex]) => {\n        levels[levelIndex].push(level[linkIndex]);\n      });\n    }\n  }\n\n  function checkLevelOverlap(\n    link: ILinkWithPos,\n    linkGroup: ILinkWithPos[]\n  ): 'intersect' | 'superset' | 'subset' | 'no-overlap' {\n    let hasSuperset = false;\n    for (let i = 0; i < linkGroup.length; i++) {\n      const linkToCompare = linkGroup[i];\n      switch (checkLinkOverlap(link, linkToCompare)) {\n        case 'intersect':\n          return 'intersect';\n\n        case 'subset':\n          return 'subset';\n\n        case 'superset':\n          hasSuperset = true;\n          continue;\n\n        case 'no-overlap':\n          continue;\n      }\n    }\n\n    return hasSuperset ? 'superset' : 'no-overlap';\n  }\n\n  function checkLinkOverlap(\n    link1: ILinkWithPos,\n    link2: ILinkWithPos\n  ): 'intersect' | 'superset' | 'subset' | 'no-overlap' {\n    const [line1Left, line1Right] = [\n      Math.min(link1.fromLinkX, link1.toLinkX),\n      Math.max(link1.fromLinkX, link1.toLinkX),\n    ];\n    const [line2Left, line2Right] = [\n      Math.min(link2.fromLinkX, link2.toLinkX),\n      Math.max(link2.fromLinkX, link2.toLinkX),\n    ];\n\n    const noOverlap = line1Right <= line2Left || line1Left >= line2Right;\n    const isSuperset = line1Left <= line2Left && line1Right >= line2Right;\n    const isSubset = line2Left < line1Left && line2Right > line1Right;\n\n    if (noOverlap) {\n      return 'no-overlap';\n    } else if (isSuperset) {\n      return 'superset';\n    } else if (isSubset) {\n      return 'subset';\n    } else {\n      return 'intersect';\n    }\n  }\n}\n\nexport function calculateLinkHeight(\n  linkLevels: Record<string, ILinkWithPos[][]>,\n  gap: number\n) {\n  const linksHeightMap: Record<string, Record<string, number>> = {};\n\n  Object.keys(linkLevels).forEach(y => {\n    linkLevels[y].forEach((links, i, arr) => {\n      links.forEach(link => {\n        linksHeightMap[link.link.id] = linksHeightMap[link.link.id] || {};\n        linksHeightMap[link.link.id][y] = (arr.length - 1 - i) * gap;\n      });\n    });\n  });\n\n  return linksHeightMap;\n}\n\nexport function shouldMultiLineGoLeft(\n  link: ILinkWithPos,\n  lineStartX: number,\n  lineWidth: number\n) {\n  const topLineX =\n    link.fromLinkY < link.toLinkY ? link.fromLinkX : link.toLinkX;\n\n  return topLineX < lineStartX + lineWidth / 2;\n}\n\nexport const fontWidth = 6;\n\nexport function attributeId(legendId: string, attributeId: string) {\n  return legendId + '_' + attributeId;\n}\n\nexport function shortId(id: string) {\n  return id.split('.').pop();\n}\n\n// export function checkAnnotationInGroup(\n//   groupIds: string[],\n//   textPack: ISinglePack,\n//   annotationId: string\n// ) {\n//   return checkMemberInGroup(groupIds, 'annotation', textPack, annotationId);\n// }\n\nexport function getGroupByAnnotation(\n  groupIds: string[],\n  textPack: ISinglePack,\n  annotationId: string\n) {\n  return getMemberInGroup(groupIds, 'annotation', textPack, annotationId);\n}\n\nexport function getGroupByLink(\n  groupIds: string[],\n  textPack: ISinglePack,\n  linkId: string\n) {\n  return getMemberInGroup(groupIds, 'link', textPack, linkId);\n}\n\n// export function checkLinkInGroup(\n//   groupIds: string[],\n//   textPack: ISinglePack,\n//   linkId: string\n// ) {\n//   return checkMemberInGroup(groupIds, 'link', textPack, linkId);\n// }\n\nexport function getMemberInGroup(\n  groupIds: string[],\n  memberType: 'link' | 'annotation',\n  textPack: ISinglePack,\n  memberId: string\n) {\n  if (!groupIds.length) {\n    return null;\n  }\n\n  const groups = textPack.groups.filter(\n    g => groupIds.includes(g.id) && g.memberType === memberType\n  );\n\n  if (groups.length) {\n    return groups.find(group => group.members.includes(memberId)) || null;\n  } else {\n    return null;\n  }\n}\n// export function checkMemberInGroup(\n//   groupIds: string[],\n//   memberType: 'link' | 'annotation',\n//   textPack: ISinglePack,\n//   memberId: string\n// ) {\n//   if (!groupIds.length) {\n//     return false;\n//   }\n\n//   const groups = textPack.groups.filter(\n//     g => groupIds.includes(g.id) && g.memberType === memberType\n//   );\n//   if (groups.length) {\n//     return groups.some(group => group.members.includes(memberId));\n//   } else {\n//     return false;\n//   }\n// }\n\nexport function isAvailableScope(config: IScopeConfigs, entryName: string) {\n  return entryName in config;\n}\n\nexport function isAvailableLegend(config: ILegendConfigs, entryName: string) {\n  // Show all legends if no configuration is provided.\n  if (Object.keys(config).length === 0) {\n    return true;\n  }\n  return entryName in config && config[entryName]['is_shown'];\n}\n\nexport function isEntryAnnotation(config: IOntology, entryName: string) {\n  return findEntryNameMatchDeep(\n    config,\n    entryName,\n    'forte.data.ontology.top.Annotation'\n  );\n}\n\nexport function isEntryLink(config: IOntology, entryName: string) {\n  return findEntryNameMatchDeep(\n    config,\n    entryName,\n    'forte.data.ontology.top.Link'\n  );\n}\n\nfunction findEntryNameMatchDeep(\n  config: IOntology,\n  entryName: string,\n  matchName: string\n): boolean {\n  if (entryName === matchName) {\n    return true;\n  }\n\n  const entry = config.definitions.find(ent => ent.entryName === entryName);\n\n  if (!entry) {\n    return false;\n  }\n\n  if (entry.parentEntryName) {\n    return findEntryNameMatchDeep(config, entry.parentEntryName, matchName);\n  } else {\n    return false;\n  }\n}\n\nexport function getGroupType(groupEntryName: string, config: IOntology) {\n  const entry = config.definitions.find(\n    ent => ent.entryName === groupEntryName\n  );\n\n  if (!entry) {\n    throw new Error('unknow group entry ' + groupEntryName);\n  }\n\n  if (entry.memberType && isEntryAnnotation(config, entry.memberType)) {\n    return 'annotation';\n  } else if (entry.memberType && isEntryLink(config, entry.memberType)) {\n    return 'link';\n  } else {\n    throw new Error('unknow group entry ' + groupEntryName);\n  }\n}\n\nexport function camelCaseDeep(obj: any): any {\n  if (Array.isArray(obj)) {\n    return obj.map(camelCaseDeep);\n  } else if (typeof obj === 'object') {\n    const camelCaseObj: any = {};\n    Object.keys(obj).forEach(key => {\n      let camelKey = key.replace(/_\\w/g, (match, offset) => {\n        if (offset === 0) {\n          return match;\n        } else {\n          return match[1].toUpperCase();\n        }\n      });\n\n      if (camelKey === 'parentEntry') {\n        camelKey = 'parentEntryName';\n      }\n      camelCaseObj[camelKey] = camelCaseDeep(obj[key]);\n    });\n    return camelCaseObj;\n  } else {\n    return obj;\n  }\n}\n","import React from 'react';\nimport {IAttributes} from '../lib/interfaces';\nimport style from '../styles/Attributes.module.css';\nimport {displayAttributeSidebar} from '../lib/utils';\n\nexport type AttributesProp = {\n  attributes: IAttributes;\n};\n\nexport default function Attributes({attributes}: AttributesProp) {\n  return (\n    <>\n      {Object.keys(attributes).map(key => (\n        <div className={style.attribute} key={key}>\n          <div className={style.attribute_name}>{key}</div>\n\n          {displayAttributeSidebar(attributes[key])}\n        </div>\n      ))}\n    </>\n  );\n}\n","import React, {useReducer, createContext, useContext} from 'react';\n\nexport type ContextProviderProps = {children: React.ReactNode};\n\nexport function createContextProvider<StateT, ActionT>(\n  reducer: (state: StateT, action: ActionT) => StateT,\n  initialState: StateT\n) {\n  type Dispatch = (action: ActionT) => void;\n\n  const StateContext = createContext<StateT | undefined>(undefined);\n  const DispatchContext = createContext<Dispatch | undefined>(undefined);\n\n  function ContextProvider({children}: ContextProviderProps) {\n    const [state, dispatch] = useReducer(reducer, initialState);\n\n    return (\n      <StateContext.Provider value={state}>\n        <DispatchContext.Provider value={dispatch}>\n          {children}\n        </DispatchContext.Provider>\n      </StateContext.Provider>\n    );\n  }\n\n  function useContextState() {\n    const context = useContext(StateContext);\n    if (context === undefined) {\n      throw new Error('useContextState must be used with a ContextProvider');\n    }\n    return context;\n  }\n\n  function useContextDispatch() {\n    const context = useContext(DispatchContext);\n    if (context === undefined) {\n      throw new Error('useContextDispatch must be used with a ContextProvider');\n    }\n    return context;\n  }\n\n  return [ContextProvider, useContextState, useContextDispatch] as [\n    typeof ContextProvider,\n    typeof useContextState,\n    typeof useContextDispatch\n  ];\n}\n","import {createContextProvider} from '../lib/create-context-provider';\nimport {IAnnotationPosition, IOntology, ISinglePack} from '../lib/interfaces';\nimport {attributeId} from '../lib/utils';\n\nexport type Dispatch = (action: Action) => void;\n\n/**\n *\n *\n * The state\n *\n *\n */\n\nexport type State = {\n  textPack: ISinglePack | null;\n  ontology: IOntology | null;\n  selectedLegendIds: string[];\n  selectedLegendAttributeIds: string[];\n\n  selectedAnnotationId: string | null;\n  halfSelectedAnnotationIds: string[]; // indicate a state that annotation is keep highlighted when link is selected\n  highlightedAnnotationIds: string[];\n\n  selectedLinkId: string | null;\n  halfSelectedLinkIds: string[]; // indicate a state that link is keep highlighted when annotation is selected\n  highlightedLinkIds: string[];\n\n  spacingCalculated: boolean;\n  spacedText: string | null;\n  charMoveMap: Map<number, number>;\n  collapsedLineIndexes: number[];\n  annotationPositions: IAnnotationPosition[];\n  textNodeWidth: number;\n\n  linkEditFromEntryId: string | null;\n  linkEditToEntryId: string | null;\n  linkEditIsDragging: boolean;\n  linkEditIsCreating: boolean;\n  linkEditSelectedLegendId: string | null;\n\n  annoEditIsCreating: boolean;\n  annoEditCursorBegin: number | null;\n  annoEditCursorEnd: number | null;\n  annoEditSelectedLegendId: string | null;\n\n  jumpToAnnotation: string | null;\n\n  selectedScopeId: string | null; // scope id is is legend id\n  selectedScopeIndex: number; // scope id is is legend id\n};\n\nconst initialSpacingState = {\n  spacingCalculated: false,\n  spacedText: null,\n  spacedAnnotationSpan: {},\n  charMoveMap: new Map(),\n  annotationPositions: [],\n  textNodeWidth: 0,\n  jumpToAnnotation: null,\n};\n\nconst initialLinkEditState = {\n  linkEditFromEntryId: null,\n  linkEditToEntryId: null,\n  linkEditIsDragging: false,\n  linkEditIsCreating: false,\n  linkEditSelectedLegendId: null,\n};\n\nconst initialAnnoEditState = {\n  annoEditIsCreating: false,\n  annoEditCursorBegin: null,\n  annoEditCursorEnd: null,\n  annoEditSelectedLegendId: null,\n};\n\nconst initialUserSelectState = {\n  selectedAnnotationId: null,\n  halfSelectedAnnotationIds: [],\n  highlightedAnnotationIds: [],\n\n  selectedLinkId: null,\n  halfSelectedLinkIds: [],\n  highlightedLinkIds: [],\n};\n\nconst initialState: State = {\n  textPack: null,\n  ontology: null,\n  selectedLegendIds: [],\n  selectedLegendAttributeIds: [],\n\n  collapsedLineIndexes: [],\n\n  ...initialUserSelectState,\n  ...initialLinkEditState,\n  ...initialSpacingState,\n  ...initialAnnoEditState,\n\n  selectedScopeId: null,\n  selectedScopeIndex: 0,\n};\n\n/**\n *\n *\n * The actions\n *\n *\n */\n\nexport type Action =\n  | {\n      type: 'set-text-pack';\n      textPack: ISinglePack;\n    }\n  | {\n      type: 'set-ontology';\n      ontology: IOntology;\n    }\n  | {\n      type: 'select-legend';\n      legendId: string;\n    }\n  | {\n      type: 'deselect-legend';\n      legendId: string;\n    }\n  | {\n      type: 'select-all-legend';\n    }\n  | {\n      type: 'deselect-all-legend';\n    }\n  | {\n      type: 'select-annotation';\n      annotationId: string;\n    }\n  | {\n      type: 'deselect-annotation';\n    }\n  | {\n      type: 'highlight-annotation';\n      annotationId: string;\n    }\n  | {\n      type: 'unhighlight-annotation';\n    }\n  | {\n      type: 'delete-annotation';\n      annotationId: string;\n    }\n  | {\n      type: 'reset-calculated-text-space';\n    }\n  | {\n      type: 'select-legend-attribute';\n      legendId: string;\n      attributeId: string;\n    }\n  | {\n      type: 'set-spaced-annotation-span';\n      spacedText: string;\n      charMoveMap: Map<number, number>;\n      annotationPositions: IAnnotationPosition[];\n      textNodeWidth: number;\n    }\n  | {\n      type: 'deselect-legend-attribute';\n      legendId: string;\n      attributeId: string;\n    }\n  | {\n      type: 'collapse-line';\n      lineIndex: number;\n    }\n  | {\n      type: 'uncollapse-line';\n      lineIndex: number;\n    }\n  | {\n      type: 'select-link';\n      linkId: string;\n    }\n  | {\n      type: 'deselect-link';\n    }\n  | {\n      type: 'highlight-link';\n      linkId: string;\n    }\n  | {\n      type: 'unhighlight-link';\n    }\n  | {\n      type: 'delete-link';\n      linkId: string;\n    }\n  | {\n      type: 'start-create-link';\n      annotationId: string;\n    }\n  | {\n      type: 'set-create-link-target';\n      annotationId: string | null;\n    }\n  | {\n      type: 'end-create-link';\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      enteredAttributes?: Record<number, any>;\n    }\n  | {\n      type: 'cancel-create-link';\n    }\n  | {\n      type: 'stop-create-link-dragging';\n      hasMoved: boolean;\n    }\n  | {\n      type: 'link-edit-select-legend-type';\n      legendId: string;\n    }\n  | {\n      type: 'start-annotation-edit';\n    }\n  | {\n      type: 'exit-annotation-edit';\n    }\n  | {\n      type: 'annotation-edit-set-begin';\n      begin: number;\n    }\n  | {\n      type: 'annotation-edit-set-end';\n      end: number;\n    }\n  | {\n      type: 'annotation-edit-cancel';\n    }\n  | {\n      type: 'annotation-edit-select-legend-type';\n      legendId: string;\n    }\n  | {\n      type: 'annotation-edit-select-text';\n      begin: number;\n      end: number;\n    }\n  | {\n      type: 'annotation-edit-submit';\n    }\n  | {\n      type: 'jump-to-annotation';\n      annotationId: string;\n    }\n  | {\n      type: 'jump-to-annotation-done';\n    }\n  | {\n      type: 'add-member-to-group';\n      groupId: string;\n      memberId: string;\n    }\n  | {\n      type: 'set-scope';\n      scopeId: string | null;\n    }\n  | {\n      type: 'set-scope-index';\n      scopeIndex: number;\n    }\n  | {type: 'prev-scope-item'}\n  | {type: 'next-scope-item'};\n\n/**\n *\n *\n * The reducer\n *\n *\n */\n\nfunction textViewerReducer(state: State, action: Action): State {\n  // ll('reducer', action);\n\n  switch (action.type) {\n    case 'set-text-pack':\n      return {\n        ...state,\n        ...initialSpacingState,\n        // textPack: action.textPack,\n        textPack: {\n          ...action.textPack,\n\n          // Validate spans.\n          annotations: action.textPack.annotations.map(anno => {\n            const text = action.textPack.text;\n\n            const begin = Math.min(text.length, Math.max(0, anno.span.begin));\n            const end = Math.min(text.length, Math.max(0, anno.span.end));\n\n            return {\n              ...anno,\n              span: {begin, end},\n            };\n          }),\n        },\n\n        // // TODO: remove the following test code\n        selectedLegendIds: state.textPack\n          ? state.selectedLegendIds\n          : [\n              // 'forte.data.ontology.base_ontology.Sentence',\n              // 'forte.data.ontology.ontonotes_ontology.PredicateMention',\n              // 'forte.data.ontology.base_ontology.PredicateArgument',\n              // 'forte.data.ontology.base_ontology.PredicateLink',\n              // 'forte.data.ontology.base_ontology.CoreferenceGroup',\n              // 'forte.data.ontology.base_ontology.Token',\n              // 'forte.data.ontology.base_ontology.CoreferenceMention',\n              // 'forte.data.ontology.base_ontology.CoreferenceGroup2',\n            ],\n        selectedLegendAttributeIds: state.textPack\n          ? state.selectedLegendAttributeIds\n          : [\n              // attributeId(\n              //   'forte.data.ontology.stanfordnlp_ontology.Token',\n              //   'pos_tag'\n              // ),\n              // attributeId('forte.data.ontology.stanfordnlp_ontology.Foo', 'name'),\n              // attributeId(action.textPack.legends.links[0].id, 'rel_type'),\n              // attributeId(\n              //   'forte.onto.base_ontology.PredicateMention',\n              //   'pred_type'\n              // ),\n              // attributeId(\n              //   'forte.onto.base_ontology.PredicateLink',\n              //   'arg_type'\n              // ),\n              // attributeId('forte.data.ontology.base_ontology.Token', 'pos_tag'),\n            ],\n\n        // selectedAnnotationId: '5',\n        // selectedGroupIds: action.textPack.groups.map(g => g.id),\n        // collapsedLineIndexes: [],\n\n        // test linkEditIsCreating\n        // linkEditFromEntryId:\n        //   'forte.data.ontology.stanfordnlp_ontology.Token.19',\n        // linkEditToEntryId: 'forte.data.ontology.stanfordnlp_ontology.Token.11',\n        // linkEditIsCreating: true,\n\n        // annoEditIsCreating: true,\n        // selectedGroupId: 'group_1',\n      };\n\n    case 'set-ontology':\n      return {\n        ...state,\n        ...initialSpacingState,\n        ontology: action.ontology,\n      };\n\n    case 'select-legend':\n      if (state.selectedLegendIds.indexOf(action.legendId) === -1) {\n        return {\n          ...state,\n          ...initialSpacingState,\n          selectedLegendIds: [...state.selectedLegendIds, action.legendId],\n        };\n      } else {\n        return {\n          ...state,\n          ...initialSpacingState,\n          selectedLegendIds: [...state.selectedLegendIds],\n        };\n      }\n\n    case 'deselect-legend':\n      if (state.selectedLegendIds.indexOf(action.legendId) === -1) {\n        return {\n          ...state,\n          ...initialSpacingState,\n          selectedLegendIds: [...state.selectedLegendIds],\n        };\n      } else {\n        return {\n          ...state,\n          ...initialSpacingState,\n          selectedLegendIds: state.selectedLegendIds.filter(\n            id => id !== action.legendId\n          ),\n        };\n      }\n\n    case 'select-all-legend':\n      if (!state.textPack || !state.ontology) {\n        return state;\n      }\n\n      return {\n        ...state,\n        ...initialSpacingState,\n        selectedLegendIds: state.ontology.definitions.map(\n          entry => entry.entryName\n        ),\n      };\n\n    case 'deselect-all-legend':\n      return {\n        ...state,\n        ...initialSpacingState,\n        selectedLegendIds: [],\n      };\n\n    case 'select-annotation': {\n      if (state.linkEditIsCreating && !state.linkEditToEntryId) {\n        return {\n          ...state,\n          linkEditToEntryId: action.annotationId,\n        };\n      }\n\n      // if (state.groupEditIsCreating) {\n      //   const groupEditAnnotationIds = [...state.groupEditAnnotationIds];\n\n      //   if (groupEditAnnotationIds.includes(action.annotationId)) {\n      //     return {\n      //       ...state,\n      //       groupEditAnnotationIds: state.groupEditAnnotationIds.filter(\n      //         id => id !== action.annotationId\n      //       ),\n      //     };\n      //   } else {\n      //     groupEditAnnotationIds.push(action.annotationId);\n\n      //     return {\n      //       ...state,\n      //       groupEditAnnotationIds,\n      //     };\n      //   }\n      // }\n\n      const halfSelectedAnnotationIds: string[] = [];\n      const halfSelectedLinkIds: string[] = [];\n\n      if (state.textPack) {\n        state.textPack.links.forEach(link => {\n          if (link.fromEntryId === action.annotationId) {\n            halfSelectedLinkIds.push(link.id);\n            halfSelectedAnnotationIds.push(link.toEntryId);\n            return;\n          }\n\n          if (link.toEntryId === action.annotationId) {\n            halfSelectedLinkIds.push(link.id);\n            halfSelectedAnnotationIds.push(link.fromEntryId);\n            return;\n          }\n        });\n      }\n\n      return {\n        ...state,\n        selectedAnnotationId: action.annotationId,\n        selectedLinkId: null,\n        halfSelectedAnnotationIds: halfSelectedAnnotationIds,\n        halfSelectedLinkIds: halfSelectedLinkIds,\n      };\n    }\n\n    case 'deselect-annotation':\n      return {\n        ...state,\n        selectedAnnotationId: null,\n        halfSelectedAnnotationIds: [],\n        halfSelectedLinkIds: [],\n      };\n\n    case 'highlight-annotation': {\n      if (state.linkEditIsDragging) {\n        return {\n          ...state,\n          highlightedAnnotationIds: [action.annotationId],\n        };\n      }\n\n      const highlightedAnnotationIds: string[] = [];\n      const highlightedLinkIds: string[] = [];\n\n      if (state.textPack) {\n        state.textPack.links.forEach(link => {\n          if (link.fromEntryId === action.annotationId) {\n            highlightedLinkIds.push(link.id);\n            highlightedAnnotationIds.push(link.toEntryId);\n            return;\n          }\n\n          if (link.toEntryId === action.annotationId) {\n            highlightedLinkIds.push(link.id);\n            highlightedAnnotationIds.push(link.fromEntryId);\n            return;\n          }\n        });\n      }\n\n      return {\n        ...state,\n        highlightedAnnotationIds: [\n          action.annotationId,\n          ...highlightedAnnotationIds,\n        ],\n        highlightedLinkIds: highlightedLinkIds,\n      };\n    }\n\n    case 'unhighlight-annotation':\n      return {\n        ...state,\n        highlightedAnnotationIds: [],\n        highlightedLinkIds: [],\n      };\n\n    case 'delete-annotation': {\n      if (!state.textPack) {\n        return state;\n      }\n\n      const annotations = state.textPack.annotations.filter(\n        ann => ann.id !== action.annotationId\n      );\n\n      const links = state.textPack.links.filter(\n        link =>\n          link.fromEntryId !== action.annotationId &&\n          link.toEntryId !== action.annotationId\n      );\n\n      const removedLinkIds = state.textPack.links\n        .filter(\n          link =>\n            link.fromEntryId === action.annotationId ||\n            link.toEntryId === action.annotationId\n        )\n        .map(l => l.id);\n\n      const groups = state.textPack.groups.map(group => {\n        const filteredMemberIds = group.members.filter(id => {\n          if (group.memberType === 'annotation') {\n            return id !== action.annotationId;\n          } else if (group.memberType === 'link') {\n            return removedLinkIds.includes(id);\n          } else {\n            throw new Error('invalid member type ' + group.memberType);\n          }\n        });\n\n        return {\n          ...group,\n          members: filteredMemberIds,\n        };\n      });\n\n      return {\n        ...state,\n        ...initialSpacingState,\n        textPack: {\n          ...state.textPack,\n          annotations,\n          links,\n          groups,\n        },\n      };\n    }\n\n    case 'select-legend-attribute': {\n      const selectedLegendAttributeIds = state.selectedLegendAttributeIds.filter(\n        id => {\n          return id.indexOf(action.legendId) !== 0;\n        }\n      );\n      selectedLegendAttributeIds.push(\n        attributeId(action.legendId, action.attributeId)\n      );\n\n      return {\n        ...state,\n        ...initialSpacingState,\n        selectedLegendAttributeIds,\n      };\n    }\n\n    case 'deselect-legend-attribute': {\n      const selectedLegendAttributeIds = state.selectedLegendAttributeIds.filter(\n        id => {\n          return id.indexOf(action.legendId) !== 0;\n        }\n      );\n\n      return {\n        ...state,\n        ...initialSpacingState,\n        selectedLegendAttributeIds,\n      };\n    }\n\n    case 'reset-calculated-text-space':\n      return {\n        ...state,\n        ...initialSpacingState,\n      };\n\n    case 'set-spaced-annotation-span':\n      return {\n        ...state,\n        spacingCalculated: true,\n        spacedText: action.spacedText,\n        charMoveMap: action.charMoveMap,\n        annotationPositions: action.annotationPositions,\n        textNodeWidth: action.textNodeWidth,\n      };\n\n    case 'collapse-line':\n      if (state.collapsedLineIndexes.indexOf(action.lineIndex) > -1) {\n        return state;\n      }\n      return {\n        ...state,\n        ...initialSpacingState,\n        collapsedLineIndexes: [...state.collapsedLineIndexes, action.lineIndex],\n      };\n\n    case 'uncollapse-line':\n      if (state.collapsedLineIndexes.indexOf(action.lineIndex) === -1) {\n        return state;\n      }\n      return {\n        ...state,\n        ...initialSpacingState,\n        collapsedLineIndexes: state.collapsedLineIndexes.filter(\n          i => i !== action.lineIndex\n        ),\n      };\n\n    case 'select-link': {\n      if (state.linkEditIsCreating && !state.linkEditToEntryId) {\n        return state;\n      }\n\n      let halfSelectedAnnotationIds: string[] = [];\n      if (state.textPack) {\n        const link = state.textPack.links.find(l => l.id === action.linkId);\n        if (link) {\n          halfSelectedAnnotationIds = [link.fromEntryId, link.toEntryId];\n        }\n      }\n\n      return {\n        ...state,\n        selectedLinkId: action.linkId,\n        halfSelectedAnnotationIds: halfSelectedAnnotationIds,\n        highlightedLinkIds: [],\n        halfSelectedLinkIds: [],\n        selectedAnnotationId: null,\n      };\n    }\n\n    case 'deselect-link':\n      return {\n        ...state,\n        selectedLinkId: null,\n      };\n\n    case 'highlight-link': {\n      if (state.linkEditIsDragging) {\n        return state;\n      }\n\n      let heighligAnnotationIds = state.highlightedAnnotationIds;\n      if (state.textPack) {\n        const link = state.textPack.links.find(l => l.id === action.linkId);\n        if (link) {\n          heighligAnnotationIds = [link.fromEntryId, link.toEntryId];\n        }\n      }\n\n      return {\n        ...state,\n        highlightedLinkIds: [action.linkId],\n        highlightedAnnotationIds: heighligAnnotationIds,\n      };\n    }\n\n    case 'unhighlight-link':\n      return {\n        ...state,\n        highlightedLinkIds: [],\n        highlightedAnnotationIds: [],\n      };\n\n    case 'delete-link': {\n      if (!state.textPack) {\n        return state;\n      }\n\n      const links = state.textPack.links.filter(\n        link => link.id !== action.linkId\n      );\n\n      const groups = state.textPack.groups.map(group => {\n        if (group.memberType === 'link') {\n          const filteredMemberIds = group.members.filter(() => !action.linkId);\n          return {\n            ...group,\n            members: filteredMemberIds,\n          };\n        } else {\n          return group;\n        }\n      });\n\n      return {\n        ...state,\n        ...initialSpacingState,\n        textPack: {\n          ...state.textPack,\n          links,\n          groups,\n        },\n      };\n    }\n\n    case 'start-create-link':\n      if (state.linkEditIsCreating) {\n        if (state.linkEditFromEntryId === action.annotationId) {\n          return {\n            ...state,\n            ...initialLinkEditState,\n          };\n        } else {\n          return state;\n        }\n      }\n\n      return {\n        ...state,\n        linkEditFromEntryId: action.annotationId,\n        linkEditIsCreating: true,\n        linkEditIsDragging: true,\n      };\n\n    case 'cancel-create-link':\n      return {\n        ...state,\n        ...initialLinkEditState,\n      };\n\n    case 'stop-create-link-dragging':\n      if (!action.hasMoved) {\n        return {\n          ...state,\n          linkEditIsDragging: false,\n        };\n      }\n\n      if (state.linkEditToEntryId) {\n        return {\n          ...state,\n          linkEditIsDragging: false,\n        };\n      }\n\n      return {\n        ...state,\n        linkEditIsDragging: false,\n        linkEditIsCreating: false,\n        linkEditFromEntryId: null,\n        linkEditToEntryId: null,\n      };\n\n    case 'end-create-link':\n      if (\n        state.linkEditToEntryId &&\n        state.linkEditFromEntryId &&\n        state.linkEditSelectedLegendId\n      ) {\n        return {\n          ...state,\n          linkEditIsDragging: false,\n          linkEditIsCreating: false,\n          linkEditFromEntryId: null,\n          linkEditToEntryId: null,\n        };\n      } else {\n        return {\n          ...state,\n          ...initialLinkEditState,\n          linkEditSelectedLegendId: state.linkEditSelectedLegendId,\n        };\n      }\n\n    case 'set-create-link-target':\n      if (state.linkEditIsDragging) {\n        return {\n          ...state,\n          linkEditToEntryId: action.annotationId,\n        };\n      } else if (state.linkEditIsCreating) {\n        return state;\n      } else {\n        return {\n          ...state,\n          linkEditFromEntryId: action.annotationId,\n        };\n      }\n\n    case 'link-edit-select-legend-type':\n      return {\n        ...state,\n        linkEditSelectedLegendId: action.legendId,\n      };\n\n    case 'start-annotation-edit':\n      return {\n        ...state,\n        ...initialLinkEditState,\n        ...initialUserSelectState,\n        // ...initialGroupEditState,\n        annoEditIsCreating: true,\n      };\n\n    case 'exit-annotation-edit':\n      return {\n        ...state,\n        ...initialAnnoEditState,\n      };\n\n    case 'annotation-edit-set-begin':\n      return {\n        ...state,\n        annoEditCursorBegin: action.begin,\n      };\n\n    case 'annotation-edit-set-end': {\n      if (\n        state.annoEditCursorBegin !== null &&\n        state.annoEditCursorBegin > action.end\n      ) {\n        return {\n          ...state,\n          annoEditCursorBegin: action.end,\n        };\n      } else {\n        return {\n          ...state,\n          annoEditCursorEnd: action.end,\n        };\n      }\n    }\n    case 'annotation-edit-cancel': {\n      return {\n        ...state,\n        ...initialAnnoEditState,\n        annoEditIsCreating: true,\n      };\n    }\n\n    case 'annotation-edit-select-text': {\n      return {\n        ...state,\n        annoEditCursorBegin: action.begin,\n        annoEditCursorEnd: action.end,\n      };\n    }\n\n    case 'annotation-edit-select-legend-type':\n      return {\n        ...state,\n        annoEditSelectedLegendId: action.legendId,\n      };\n\n    case 'annotation-edit-submit': {\n      return {\n        ...state,\n        annoEditCursorBegin: null,\n        annoEditCursorEnd: null,\n      };\n    }\n\n    case 'jump-to-annotation': {\n      return {\n        ...state,\n        jumpToAnnotation: action.annotationId,\n      };\n    }\n\n    case 'jump-to-annotation-done': {\n      return {\n        ...state,\n        jumpToAnnotation: null,\n      };\n    }\n\n    case 'add-member-to-group': {\n      const textPack = state.textPack as ISinglePack;\n      const groups = textPack.groups.map(g => {\n        if (g.id === action.groupId) {\n          return {\n            ...g,\n            members: [...g.members, action.memberId],\n          };\n        } else {\n          return g;\n        }\n      });\n\n      return {\n        ...state,\n        textPack: {\n          ...textPack,\n          groups,\n        },\n      };\n    }\n\n    case 'set-scope': {\n      return {\n        ...state,\n        ...initialSpacingState,\n        selectedScopeIndex: 0,\n        selectedScopeId: action.scopeId,\n      };\n    }\n\n    case 'set-scope-index': {\n      return {\n        ...state,\n        ...initialSpacingState,\n        selectedScopeIndex: action.scopeIndex,\n      };\n    }\n\n    case 'prev-scope-item': {\n      const prevScopeIndex =\n        state.selectedScopeIndex <= 0 ? 0 : state.selectedScopeIndex - 1;\n\n      return {\n        ...state,\n        ...initialSpacingState,\n        selectedScopeIndex: prevScopeIndex,\n      };\n    }\n\n    case 'next-scope-item': {\n      if (!state.textPack) return state;\n\n      const scopeAnnotations = state.textPack.annotations.filter(\n        ann => ann.legendId === state.selectedScopeId\n      );\n      const prevScopeIndex =\n        state.selectedScopeIndex >= scopeAnnotations.length\n          ? 0\n          : state.selectedScopeIndex + 1;\n\n      return {\n        ...state,\n        ...initialSpacingState,\n        selectedScopeIndex: prevScopeIndex,\n      };\n    }\n  }\n}\n\nlet __currentState: State = initialState;\n\nfunction storeCurrentStateReducer(state: State): State {\n  __currentState = state;\n  return state;\n}\n\nfunction combineReducers(...reducers: Array<typeof textViewerReducer>) {\n  return (state: State, action: Action) => {\n    reducers.forEach(reducer => {\n      state = reducer(state, action);\n    });\n\n    return state;\n  };\n}\n\nfunction getState() {\n  return __currentState;\n}\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst w: any = window;\nw.getState = getState;\n\nconst [\n  TextViewerProvider,\n  useTextViewerState,\n  useTextViewerDispatch,\n] = createContextProvider(\n  combineReducers(textViewerReducer, storeCurrentStateReducer),\n  initialState\n);\n\nexport {\n  TextViewerProvider,\n  useTextViewerState,\n  useTextViewerDispatch,\n  getState,\n};\n","import React from 'react';\nimport {IAnnotation} from '../lib/interfaces';\nimport Attributes from './Attributes';\nimport style from '../styles/AnnotationDetail.module.css';\nimport {useTextViewerDispatch} from '../contexts/text-viewer.context';\nimport {shortId} from '../lib/utils';\nimport {OnEventType} from './TextViewer';\nimport { NLPViewerOptions } from '..';\n\nexport interface AnnotationDetailProp {\n  annotation: IAnnotation;\n  parentAnnotations: IAnnotation[];\n  childAnnotations: IAnnotation[];\n  onEvent?: OnEventType;\n  options?: NLPViewerOptions;\n}\n\nexport default function AnnotationDetail({\n  annotation,\n  parentAnnotations,\n  childAnnotations,\n  onEvent,\n  options,\n}: AnnotationDetailProp) {\n  const dispatch = useTextViewerDispatch();\n\n  function renderLinkedAnnotations(annotations: IAnnotation[], title: string) {\n    if (!annotations.length) {\n      return null;\n    }\n\n    return (\n      <div className={style.linked_annotation_container}>\n        <strong>{title}</strong>\n        {annotations.map(ann => {\n          return (\n            <span\n              key={ann.id}\n              title={ann.id}\n              className={style.linked_annotation}\n              onClick={() => {\n                dispatch({\n                  type: 'select-annotation',\n                  annotationId: ann.id,\n                });\n              }}\n            >\n              {shortId(ann.id)}\n            </span>\n          );\n        })}\n      </div>\n    );\n  }\n\n  return (\n    <div className={style.annotation_detail}>\n      {renderLinkedAnnotations(parentAnnotations, '↘ parents')}\n      {renderLinkedAnnotations(childAnnotations, '↗ children')}\n\n      <div className={style.annotation_detail_section}>\n        <h2>Attributes</h2>\n        <div className={style.annotation_detail_section_body}>\n          <Attributes\n            attributes={{\n              id: annotation.id,\n              ...annotation.attributes,\n            }}\n          />\n        </div>\n      </div>\n      {(options && options.allowEditAnnotations) && (\n        <div>\n          <button\n            onClick={() => {\n              if (onEvent) {\n                onEvent({\n                  type: 'annotation-delete',\n                  annotationId: annotation.id,\n                });\n              }\n\n              dispatch({\n                type: 'delete-annotation',\n                annotationId: annotation.id,\n              });\n            }}\n          >\n            remove\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}\n","import React from 'react';\nimport {ILink} from '../lib/interfaces';\nimport Attributes from './Attributes';\nimport {useTextViewerDispatch} from '../contexts/text-viewer.context';\nimport {OnEventType} from './TextViewer';\n\nexport interface LinkDetailProp {\n  link: ILink | null;\n  onEvent?: OnEventType;\n}\n\nexport default function LinkDetail({link, onEvent}: LinkDetailProp) {\n  const dispatch = useTextViewerDispatch();\n\n  if (link === null) {\n    return null;\n  }\n\n  return (\n    <div>\n      <Attributes\n        attributes={{\n          id: link.id,\n          ...link.attributes,\n        }}\n      />\n\n      <div>\n        <button\n          onClick={() => {\n            if (onEvent) {\n              onEvent({\n                type: 'link-delete',\n                linkId: link.id,\n              });\n            }\n\n            dispatch({\n              type: 'delete-link',\n              linkId: link.id,\n            });\n          }}\n        >\n          remove\n        </button>\n      </div>\n    </div>\n  );\n}\n","import React from 'react';\nimport IconButton from '@material-ui/core/IconButton';\nimport MoreVertIcon from '@material-ui/icons/MoreVert';\nimport {Dispatch} from '../contexts/text-viewer.context';\nimport {IEntryDefinition} from '../lib/interfaces';\nimport {attributeId} from '../lib/utils';\nimport style from '../styles/LegendList.module.css';\n\ninterface LegendListProp {\n  legends: (IEntryDefinition & {color: string})[];\n  selectedLegendIds: string[];\n  selectedLegendAttributeIds: string[];\n  dispatch: Dispatch;\n}\n\nexport default function LegendList({\n  legends,\n  selectedLegendIds,\n  selectedLegendAttributeIds,\n  dispatch,\n}: LegendListProp) {\n  return (\n    <div className={style.annotation_legend_container}>\n      <ul className={style.list}>\n        {legends.map((legend, i) => {\n          const isSelected = selectedLegendIds.indexOf(legend.entryName) > -1;\n\n          return (\n            <li key={legend.entryName + i}>\n              <div\n                className={style.lengend_container}\n                onClick={() => {\n                  isSelected\n                    ? dispatch({\n                        type: 'deselect-legend',\n                        legendId: legend.entryName,\n                      })\n                    : dispatch({\n                        type: 'select-legend',\n                        legendId: legend.entryName,\n                      });\n                }}\n              >\n                <input type=\"checkbox\" readOnly checked={isSelected} />\n                <div\n                  style={{\n                    backgroundColor: legend.color,\n                    color: '#595959',\n                    fontWeight: 500,\n                    padding: '5px',\n                    marginLeft: '10px',\n                    minWidth: '193px',\n                    borderTopLeftRadius: '6px',\n                    borderBottomLeftRadius: '6px',\n                    fontSize: '16px',\n                  }}\n                >\n                  {legend.entryName.split('.').pop()}\n                </div>\n                <div\n                  style={{\n                    position: 'relative',\n                    right: 40,\n                    top: 2,\n                  }}\n                >\n                  <IconButton aria-label=\"More\">\n                    <MoreVertIcon fontSize=\"small\" />\n                  </IconButton>\n                </div>\n              </div>\n\n              {legend.attributes ? (\n                <div className={style.attribute_name_container}>\n                  {legend.attributes.map(attr => {\n                    const isSelected =\n                      selectedLegendAttributeIds.indexOf(\n                        attributeId(legend.entryName, attr.name)\n                      ) > -1;\n\n                    return (\n                      <div\n                        className={style.attribute_name}\n                        key={attr.name}\n                        onClick={() => {\n                          isSelected\n                            ? dispatch({\n                                type: 'deselect-legend-attribute',\n                                legendId: legend.entryName,\n                                attributeId: attr.name,\n                              })\n                            : dispatch({\n                                type: 'select-legend-attribute',\n                                legendId: legend.entryName,\n                                attributeId: attr.name,\n                              });\n                        }}\n                      >\n                        <input type=\"radio\" readOnly checked={isSelected} />\n                        {attr.name}\n                      </div>\n                    );\n                  })}\n                </div>\n              ) : null}\n            </li>\n          );\n        })}\n      </ul>\n    </div>\n  );\n}\n","import React from 'react';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport {withStyles, Theme} from '@material-ui/core/styles';\nimport IconButton from '@material-ui/core/IconButton';\nimport InfoIcon from '@material-ui/icons/Info';\n\nimport {IEntryDefinition, IAttributes} from '../lib/interfaces';\nimport {\n  useTextViewerState,\n  useTextViewerDispatch,\n} from '../contexts/text-viewer.context';\nimport Attributes from './Attributes';\nimport LegendList from './LegendList';\n\nexport interface TextDetailProp {\n  attributes: IAttributes;\n  annotationLegends: (IEntryDefinition & {color: string})[];\n  linkLegends: (IEntryDefinition & {color: string})[];\n}\n\nexport default function TextDetail({\n  attributes,\n  annotationLegends,\n  linkLegends,\n}: TextDetailProp) {\n  const {selectedLegendIds, selectedLegendAttributeIds} = useTextViewerState();\n  const HtmlTooltip = withStyles((theme: Theme) => ({\n    tooltip: {\n      backgroundColor: '#f5f5f9',\n      color: 'rgba(0, 0, 0, 0.87)',\n      maxWidth: 220,\n      minWidth: 200,\n      fontSize: theme.typography.pxToRem(12),\n      border: '1px solid #dadde9',\n    },\n  }))(Tooltip);\n  const metadataTabItem = {\n    title: 'metadata',\n    body: () => (\n      <div>\n        Metadata\n        <Attributes attributes={attributes} />\n      </div>\n    ),\n  };\n\n  const dispatch = useTextViewerDispatch();\n  return (\n    <>\n      <HtmlTooltip\n        title={\n          <React.Fragment>\n            Metadata\n            <Attributes attributes={attributes} />\n          </React.Fragment>\n        }\n      >\n        <IconButton\n          aria-label=\"Info Metadata\"\n          style={{marginLeft: 190, marginTop: -55}}\n        >\n          <InfoIcon />\n        </IconButton>\n      </HtmlTooltip>\n\n      <LegendList\n        legends={[...annotationLegends, ...linkLegends]}\n        selectedLegendIds={selectedLegendIds}\n        selectedLegendAttributeIds={selectedLegendAttributeIds}\n        dispatch={dispatch}\n      />\n    </>\n  );\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  ISpaceMap,\n  ILinkWithPos,\n  IAnnotationPosition,\n  IAnnotation,\n  ILink,\n} from './interfaces';\nimport {notNullOrUndefined, attributeId} from './utils';\n\nexport const fontWidth = 6;\n\nexport interface SpacedText {\n  spacedText: string;\n  charMoveMap: Map<number, number>;\n  annotationPositions: IAnnotationPosition[];\n  textNodeWidth: number;\n}\n\n/**\n *\n * Given\n *  - a text pack (with links, annotations)\n *  - selected legend ids (to know which annotation and link are effecting),\n *  - selected attribute ids (to know what link label are effecting) and lines to be collapsed\n *\n * calculate\n *  - new text that inserted empty space and new lines\n *  - a map of [annotation original end position] to number of character to insert after\n *    - used to restore the original position when new annotation is added to new text\n *  - every annotation's new position\n *  - dimension of the text node\n *\n * the calculation has two steps, first it find and insert empty space, then based on\n * the result, decide how many new line to insert between each line.\n *\n */\nexport function spaceOutText(\n  annotations: IAnnotation[],\n  text: string,\n  links: ILink[],\n  selectedLegendIds: string[],\n  selectedLegendAttributeIds: string[],\n  collapsedLinesIndex: number[]\n): SpacedText {\n  const existSpaceEl = document.getElementById('text-spacer');\n  if (existSpaceEl) {\n    existSpaceEl.remove();\n  }\n\n  const root = document.getElementById('root') as HTMLElement;\n  const textNodeEl = document.createElement('div');\n  const scrollbarWidth = getScrollbarWidth();\n  const otherWidth = 250 * 2 + 16 * 2 + scrollbarWidth; // two side panel + 2 padding\n\n  textNodeEl.id = 'text-spacer';\n  textNodeEl.style.width = `calc(100% - ${otherWidth}px)`;\n  textNodeEl.style.minWidth = '350px';\n  textNodeEl.style.margin = '50px auto';\n  textNodeEl.style.whiteSpace = 'pre-wrap';\n  textNodeEl.style.lineHeight = '20px';\n  textNodeEl.style.border = '1px solid red';\n  textNodeEl.style.position = 'fixed';\n  textNodeEl.style.left = '-9999px';\n  textNodeEl.textContent = text;\n\n  root.appendChild(textNodeEl);\n\n  // // START: debugging text view\n  // textNodeEl.style.top = '0';\n  // textNodeEl.style.left = '0';\n  // textNodeEl.style.background = 'white';\n  // textNodeEl.style.zIndex = '100';\n\n  // const dom = document.createElement('div');\n  // textNodeEl.appendChild(dom);\n  // dom.style.whiteSpace = 'pre-wrap';\n  // // END: debugging text view\n\n  const textNode = textNodeEl && (textNodeEl.childNodes[0] as HTMLElement);\n\n  const textAreaRect = textNodeEl.getBoundingClientRect();\n\n  const textAreaDimensionWithEmptySpace = {\n    width: textAreaRect.width,\n    height: textAreaRect.height,\n  };\n\n  // add invisibleAnnotations for each words,\n  // so that long annotation can be broken down\n  const invisibleAnnotations: any[] = [];\n  let currPosition = -1;\n  text.split(/\\s/).forEach((text, i) => {\n    invisibleAnnotations.push({\n      span: {begin: currPosition + 1, end: currPosition + 1 + text.length},\n      id: 'i-' + i,\n      legendId: 'invisible',\n      attributes: {},\n    });\n    currPosition = currPosition + 1 + text.length;\n  });\n\n  annotations = annotations.concat(invisibleAnnotations);\n\n  const annotationsPos = annotations.map(anno => {\n    const range = document.createRange();\n\n    range.setStart(textNode, anno.span.begin);\n    range.setEnd(textNode, anno.span.end);\n    const rects = Array.from(range.getClientRects() as DOMRectList);\n\n    return {\n      rects: rects.map(rect => ({\n        x: rect.x - textAreaRect.left,\n        y: rect.y - textAreaRect.top,\n        width: rect.width,\n        height: rect.height,\n      })),\n    };\n  });\n\n  const annotationsWithPos = mergeAnnotationWithPosition(\n    annotationsPos,\n    annotations\n  ).filter(\n    ann =>\n      ann.annotation.legendId === 'invisible' ||\n      selectedLegendIds.indexOf(ann.annotation.legendId) > -1\n  );\n\n  const linksWithPos = mergeLinkWithPosition(links, annotationsWithPos).filter(\n    link => selectedLegendIds.indexOf(link.link.legendId) > -1\n  );\n\n  const spaceMap: ISpaceMap = calculateSpaceMap(\n    annotationsWithPos,\n    linksWithPos,\n    selectedLegendAttributeIds\n  );\n\n  const [\n    calculatedSpacedTextWithEmptySpace,\n    calculatedSpacedAnnotationSpanWithEmptySpace,\n  ] = calculateNewText(annotations, text, spaceMap, ' ');\n\n  textNodeEl.textContent = calculatedSpacedTextWithEmptySpace;\n\n  const textAreaRectWithEmptySpace = textNodeEl.getBoundingClientRect();\n  const textNodeWithEmptySpace =\n    textNodeEl && (textNodeEl.childNodes[0] as HTMLElement);\n\n  const annotationsPosWithEmptySpaces = annotations.map(anno => {\n    const range = document.createRange();\n\n    range.setStart(\n      textNodeWithEmptySpace,\n      calculatedSpacedAnnotationSpanWithEmptySpace[anno.id].begin\n    );\n    range.setEnd(\n      textNodeWithEmptySpace,\n      calculatedSpacedAnnotationSpanWithEmptySpace[anno.id].end\n    );\n    const rects = Array.from(range.getClientRects() as DOMRectList);\n\n    return {\n      rects: rects.map(rect => ({\n        x: rect.x - textAreaRectWithEmptySpace.left,\n        y: rect.y - textAreaRectWithEmptySpace.top,\n        width: rect.width,\n        height: rect.height,\n      })),\n    };\n  });\n\n  const annotationsWithPosWithEmptySpaces = mergeAnnotationWithPosition(\n    annotationsPosWithEmptySpaces,\n    annotations\n  ).filter(\n    ann =>\n      ann.annotation.legendId === 'invisible' ||\n      selectedLegendIds.indexOf(ann.annotation.legendId) > -1\n  );\n\n  const linksWithPosWithEmptySpaces = mergeLinkWithPosition(\n    links,\n    annotationsWithPosWithEmptySpaces\n  ).filter(link => selectedLegendIds.indexOf(link.link.legendId) > -1);\n\n  const lineStartXWithEmptySpace = 0; //textAreaDimensionWithEmptySpace.x;\n  const lineWidthWithEmptySpace = textAreaDimensionWithEmptySpace.width;\n\n  const linesLevelsWithNewline = {\n    ...getLevelsFromJustAnnotations(annotationsWithPosWithEmptySpaces),\n    ...calculateLinesLevels(\n      linksWithPosWithEmptySpaces,\n      lineStartXWithEmptySpace,\n      lineWidthWithEmptySpace\n    ),\n  };\n\n  const spaceMapWithNewline: ISpaceMap = {};\n\n  Object.keys(linesLevelsWithNewline).forEach((lineHeight, i) => {\n    const levelNum = linesLevelsWithNewline[lineHeight].length;\n    const annotationsAtCurrLine = getAnnotationsByLine(\n      annotationsWithPosWithEmptySpaces,\n      +lineHeight\n    );\n\n    const firstAnnotation = annotationsAtCurrLine[0];\n    const fullOfInvisible = annotationsAtCurrLine.every(\n      ann => ann.annotation.legendId === 'invisible'\n    );\n\n    spaceMapWithNewline[firstAnnotation.annotation.id] = {\n      annotationWithPos: {\n        position: firstAnnotation.position,\n        annotation: {\n          ...firstAnnotation.annotation,\n          span: {\n            begin:\n              calculatedSpacedAnnotationSpanWithEmptySpace[\n                firstAnnotation.annotation.id\n              ].begin,\n            end:\n              calculatedSpacedAnnotationSpanWithEmptySpace[\n                firstAnnotation.annotation.id\n              ].end,\n          },\n        },\n      },\n      spaceToMove: fullOfInvisible\n        ? 0\n        : calculateLinesToInsertByLevelNum(collapsedLinesIndex, i, levelNum),\n    };\n  });\n\n  const updatedTextPackWithNewline = {\n    text: calculatedSpacedTextWithEmptySpace,\n    annotations: annotations.map(ann => {\n      return {\n        ...ann,\n        span: {\n          begin: calculatedSpacedAnnotationSpanWithEmptySpace[ann.id].begin,\n          end: calculatedSpacedAnnotationSpanWithEmptySpace[ann.id].end,\n        },\n      };\n    }),\n  };\n\n  const [textWithNewLine, annotationSpanMap] = calculateNewText(\n    updatedTextPackWithNewline.annotations,\n    updatedTextPackWithNewline.text,\n    spaceMapWithNewline,\n    '\\n',\n    'before'\n  );\n\n  textNodeEl.textContent = textWithNewLine;\n\n  const textNodeWithNewline =\n    textNodeEl && (textNodeEl.childNodes[0] as HTMLElement);\n  const textAreaRectWithNewLine = textNodeEl.getBoundingClientRect() as DOMRect;\n  const lineWidthWithNewLine = textAreaRectWithNewLine.width;\n\n  const annotationPositionsWithNewLine = annotations\n    .filter(a => a.legendId !== 'invisible')\n    .map(anno => {\n      const range = document.createRange();\n\n      range.setStart(textNodeWithNewline, annotationSpanMap[anno.id].begin);\n      range.setEnd(textNodeWithNewline, annotationSpanMap[anno.id].end);\n\n      let rects = Array.from(range.getClientRects() as DOMRectList);\n\n      if (rects.length > 1) {\n        rects = rects.filter(rect => rect.width > 5);\n      }\n\n      return {\n        rects: rects.map(rect => ({\n          x: rect.x - textAreaRectWithNewLine.left,\n          y: rect.y - textAreaRectWithNewLine.top,\n          width: rect.width,\n          height: rect.height,\n        })),\n      };\n    });\n\n  const charMoveMap = new Map<number, number>();\n  Object.keys(spaceMap).forEach(annId => {\n    const annotation = annotations.find(ann => ann.id === annId);\n    if (annotation) {\n      charMoveMap.set(annotation.span.end, spaceMap[annId].spaceToMove);\n    }\n  });\n\n  Object.keys(spaceMapWithNewline).forEach(annId => {\n    const annotation = annotations.find(ann => ann.id === annId);\n    if (annotation) {\n      charMoveMap.set(\n        annotation.span.begin - 1,\n        spaceMapWithNewline[annId].spaceToMove +\n          (charMoveMap.get(annotation.span.begin - 1) || 0)\n      );\n    }\n  });\n\n  return {\n    spacedText: textWithNewLine,\n    charMoveMap,\n    annotationPositions: annotationPositionsWithNewLine,\n    textNodeWidth: lineWidthWithNewLine,\n  };\n}\n\n/**\n *\n * merge annotation data with its position in the text.\n *\n * so it's easy to access both data\n *\n */\nexport function mergeAnnotationWithPosition(\n  annotationPositions: IAnnotationPosition[],\n  annotations: IAnnotation[]\n) {\n  return (annotationPositions || []).map((position, i) => {\n    return {\n      position,\n      annotation: annotations[i],\n    };\n  });\n}\n\n/**\n *\n * merge link data with the corresponding annotation\n * data and their position, also calculate the link's\n * position based on their corresponding annotation\n *\n * so it's easy to access both data\n *\n */\nexport function mergeLinkWithPosition(\n  links: ILink[],\n  annotationWithPosition: {\n    position: IAnnotationPosition;\n    annotation: IAnnotation;\n  }[]\n) {\n  return links\n    .map(link => {\n      const fromEntryWithPosition = annotationWithPosition.find(\n        ann => ann.annotation.id === link.fromEntryId\n      );\n      const toEntryWithPosition = annotationWithPosition.find(\n        ann => ann.annotation.id === link.toEntryId\n      );\n      if (fromEntryWithPosition && toEntryWithPosition) {\n        const fromEntryX = fromEntryWithPosition.position.rects[0].x;\n        const fromEntryY = fromEntryWithPosition.position.rects[0].y;\n        const fromEntryWidth = fromEntryWithPosition.position.rects[0].width;\n        const toEntryX = toEntryWithPosition.position.rects[0].x;\n        const toEntryY = toEntryWithPosition.position.rects[0].y;\n        const toEntryWidth = toEntryWithPosition.position.rects[0].width;\n        const fromLinkX = fromEntryX + fromEntryWidth / 2;\n        const toLinkX = toEntryX + toEntryWidth / 2;\n        return {\n          link,\n          fromEntryWithPos: fromEntryWithPosition,\n          toEntryWithPos: toEntryWithPosition,\n          fromLinkX,\n          toLinkX,\n          fromLinkY: fromEntryY,\n          toLinkY: toEntryY,\n        };\n      } else {\n        return null;\n      }\n    })\n    .filter(notNullOrUndefined);\n}\n\n/**\n *\n * given a map of [each annotation] to\n * [number empty space need to insert], calculate\n * the new text after inserting those empty\n * spaces. Meanwhile, also calculate a map of\n * [each annotation] to [their position in the new text]\n *\n */\nfunction calculateNewText(\n  annotations: IAnnotation[],\n  text: string,\n  spaceMap: ISpaceMap,\n  fill: string,\n  insertDirection: 'before' | 'after' = 'after'\n) {\n  const textSplit = text.split('');\n  const sortedSpaceMap = Object.keys(spaceMap)\n    .filter(annId => spaceMap[annId].spaceToMove > 0)\n    .map(annId => spaceMap[annId])\n    .sort((annA, annB) => {\n      return (\n        annA.annotationWithPos.annotation.span.end -\n        annB.annotationWithPos.annotation.span.end\n      );\n    });\n\n  const spacedAnnotationSpan: {\n    [key: string]: {begin: number; end: number};\n  } = {};\n\n  annotations.forEach(ann => {\n    spacedAnnotationSpan[ann.id] = {\n      begin: ann.span.begin,\n      end: ann.span.end,\n    };\n  });\n\n  for (let i = 0; i < sortedSpaceMap.length; i++) {\n    const space = sortedSpaceMap[i];\n    const spaceFromLast = sortedSpaceMap[sortedSpaceMap.length - i - 1];\n    const emptySpaces = Array(spaceFromLast.spaceToMove).fill(fill).join('');\n\n    if (insertDirection === 'before') {\n      textSplit.splice(\n        spaceFromLast.annotationWithPos.annotation.span.begin,\n        0,\n        emptySpaces\n      );\n\n      const begin =\n        spacedAnnotationSpan[space.annotationWithPos.annotation.id].begin;\n\n      Object.keys(spacedAnnotationSpan).forEach(annId => {\n        if (spacedAnnotationSpan[annId].begin >= begin) {\n          spacedAnnotationSpan[annId].begin =\n            spacedAnnotationSpan[annId].begin + space.spaceToMove;\n          spacedAnnotationSpan[annId].end =\n            spacedAnnotationSpan[annId].end + space.spaceToMove;\n        } else if (\n          spacedAnnotationSpan[annId].begin < begin &&\n          spacedAnnotationSpan[annId].end > begin\n        ) {\n          spacedAnnotationSpan[annId].end =\n            spacedAnnotationSpan[annId].end + space.spaceToMove;\n        } else {\n          // don't change\n        }\n      });\n    } else {\n      textSplit.splice(\n        spaceFromLast.annotationWithPos.annotation.span.end,\n        0,\n        emptySpaces\n      );\n\n      const end =\n        spacedAnnotationSpan[space.annotationWithPos.annotation.id].end;\n\n      Object.keys(spacedAnnotationSpan).forEach(annId => {\n        if (spacedAnnotationSpan[annId].begin >= end) {\n          spacedAnnotationSpan[annId].begin =\n            spacedAnnotationSpan[annId].begin + space.spaceToMove;\n          spacedAnnotationSpan[annId].end =\n            spacedAnnotationSpan[annId].end + space.spaceToMove;\n        } else if (\n          spacedAnnotationSpan[annId].begin < end &&\n          spacedAnnotationSpan[annId].end > end\n        ) {\n          spacedAnnotationSpan[annId].end =\n            spacedAnnotationSpan[annId].end + space.spaceToMove;\n        } else {\n          // don't change\n        }\n      });\n    }\n  }\n\n  const spacedText = textSplit.join('');\n\n  return [spacedText, spacedAnnotationSpan] as [\n    typeof spacedText,\n    typeof spacedAnnotationSpan\n  ];\n}\n\n/**\n *\n * Given links with their position, the starting position\n * of a line, and the width of a line. Find, for each\n * line, how many levels is that line, and what links\n * are in each level. So that no links are overlapped.\n *\n * at the end, a line looks like:\n *\n *                    |‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|\n *      |‾‾‾‾‾‾‾‾‾‾‾‾‾|‾‾‾‾‾‾|           |\n *   |‾‾|‾‾‾‾‾‾| |‾‾‾‾|‾‾| |‾|‾‾‾‾|      |\n *   *  *      * *    *  * * *    *      *\n */\nfunction calculateLinesLevels(\n  linksWithPos: ILinkWithPos[],\n  lineStartX: number,\n  lineWidth: number\n): Record<string, ILinkWithPos[][]> {\n  const lineMap: any = {};\n  linksWithPos.forEach(link => {\n    if (link.fromLinkY === link.toLinkY) {\n      lineMap[link.fromLinkY] = lineMap[link.fromLinkY] || [];\n      lineMap[link.fromLinkY].push(link);\n    } else {\n      const goLeft = shouldMultiLineGoLeft(link, lineStartX, lineWidth);\n      lineMap[link.fromLinkY] = lineMap[link.fromLinkY] || [];\n      lineMap[link.fromLinkY].push({\n        ...link,\n        toLinkY: link.fromLinkY,\n        toLinkX: goLeft ? lineStartX : lineStartX + lineWidth,\n      });\n\n      lineMap[link.toLinkY] = lineMap[link.toLinkY] || [];\n      lineMap[link.toLinkY].push({\n        ...link,\n        fromLinkY: link.toLinkY,\n        fromLinkX: goLeft ? lineStartX : lineStartX + lineWidth,\n      });\n    }\n  });\n\n  Object.keys(lineMap).forEach(key => {\n    lineMap[key] = calculateLevelForSingleLine(lineMap[key]);\n  });\n\n  return lineMap;\n\n  /**\n   *\n   * go through each level from top\n   * - if no overlap with any link in current level, push to same level\n   * - if there is overlap but only super set, insert a level above, and push to it\n   * - if reach the end, insert a new level below then push to it\n   * - otherwise, check lower level.\n   *\n   * after levels is build\n   * - push each link down into lower levels\n   *\n   */\n  function calculateLevelForSingleLine(\n    links: ILinkWithPos[]\n  ): ILinkWithPos[][] {\n    const levels: ILinkWithPos[][] = [];\n    links.forEach(link => {\n      let insertLevel = -1;\n      let pushLevel = -1;\n      for (let i = 0; i < levels.length; i++) {\n        let shouldBreak = false;\n        let shouldContinue = false;\n        switch (checkLevelOverlap(link, levels[i])) {\n          case 'superset':\n            insertLevel = i;\n            shouldBreak = true;\n            break;\n          case 'no-overlap':\n            pushLevel = i;\n            shouldBreak = true;\n            break;\n          case 'subset':\n          case 'intersect':\n            shouldContinue = true;\n            break;\n        }\n        if (shouldBreak) break;\n        if (shouldContinue) continue;\n      }\n\n      if (insertLevel !== -1) {\n        levels.splice(insertLevel, 0, [link]);\n      } else if (pushLevel !== -1) {\n        levels[pushLevel].push(link);\n      } else {\n        levels.push([link]);\n      }\n    });\n\n    pushDownLinksInLevels(levels);\n    return levels.filter(l => l.length);\n  }\n\n  // go through each level from bottom to top\n  // - if the link can be push down, move the link to the lower level, until we can't\n  //   - to check if the link can be push down, check lower level has intersects\n  function pushDownLinksInLevels(levels: ILinkWithPos[][]) {\n    for (let i = levels.length - 2; i >= 0; i--) {\n      const level = levels[i];\n      const linksToPush: number[][] = [];\n\n      for (let j = 0; j < level.length; j++) {\n        const link = level[j];\n        let levelToPush = -1;\n        for (let k = i + 1; k < levels.length; k++) {\n          if (checkLevelOverlap(link, levels[k]) === 'no-overlap') {\n            levelToPush = k;\n          } else {\n            break;\n          }\n        }\n        if (levelToPush !== -1) {\n          linksToPush.push([j, levelToPush]);\n        }\n      }\n\n      levels[i] = level.filter(\n        (_, i) => linksToPush.map(l => l[0]).indexOf(i) === -1\n      );\n      linksToPush.forEach(([linkIndex, levelIndex]) => {\n        levels[levelIndex].push(level[linkIndex]);\n      });\n    }\n  }\n\n  /**\n   *\n   * Check if a link is horizontally with a group of links\n   *\n   */\n  function checkLevelOverlap(\n    link: ILinkWithPos,\n    linkGroup: ILinkWithPos[]\n  ): 'intersect' | 'superset' | 'subset' | 'no-overlap' {\n    let hasSuperset = false;\n    for (let i = 0; i < linkGroup.length; i++) {\n      const linkToCompare = linkGroup[i];\n      switch (checkLinkOverlap(link, linkToCompare)) {\n        case 'intersect':\n          return 'intersect';\n\n        case 'subset':\n          return 'subset';\n\n        case 'superset':\n          hasSuperset = true;\n          continue;\n\n        case 'no-overlap':\n          continue;\n      }\n    }\n\n    return hasSuperset ? 'superset' : 'no-overlap';\n  }\n\n  /**\n   *\n   * Check if a link is horizontally overlap with another link,\n   *\n   */\n\n  function checkLinkOverlap(\n    link1: ILinkWithPos,\n    link2: ILinkWithPos\n  ): 'intersect' | 'superset' | 'subset' | 'no-overlap' {\n    const [line1Left, line1Right] = [\n      Math.min(link1.fromLinkX, link1.toLinkX),\n      Math.max(link1.fromLinkX, link1.toLinkX),\n    ];\n    const [line2Left, line2Right] = [\n      Math.min(link2.fromLinkX, link2.toLinkX),\n      Math.max(link2.fromLinkX, link2.toLinkX),\n    ];\n\n    const noOverlap = line1Right <= line2Left || line1Left >= line2Right;\n    const isSuperset = line1Left <= line2Left && line1Right >= line2Right;\n    const isSubset = line2Left < line1Left && line2Right > line1Right;\n\n    if (noOverlap) {\n      return 'no-overlap';\n    } else if (isSuperset) {\n      return 'superset';\n    } else if (isSubset) {\n      return 'subset';\n    } else {\n      return 'intersect';\n    }\n  }\n}\n\n/**\n *\n * Give a map of [line (represented by height)]\n * to [links grouped in levels in that line], and\n * the gap height of each level\n *\n * Find how many pixels above each line is needed in order\n * to display all the levels above each line.\n *\n */\nexport function calculateLinkHeight(\n  linkLevels: Record<string, ILinkWithPos[][]>,\n  gap: number\n) {\n  const linksHeightMap: Record<string, Record<string, number>> = {};\n\n  Object.keys(linkLevels).forEach(y => {\n    linkLevels[y].forEach((links, i, arr) => {\n      links.forEach(link => {\n        linksHeightMap[link.link.id] = linksHeightMap[link.link.id] || {};\n        linksHeightMap[link.link.id][y] = (arr.length - 1 - i) * gap;\n      });\n    });\n  });\n\n  return linksHeightMap;\n}\n\n/**\n *\n * give a link with position that not are at the same\n * line, decide if it should go left of right.\n *\n */\nexport function shouldMultiLineGoLeft(\n  link: ILinkWithPos,\n  lineStartX: number,\n  lineWidth: number\n) {\n  const topLineX =\n    link.fromLinkY < link.toLinkY ? link.fromLinkX : link.toLinkX;\n  return topLineX < lineStartX + lineWidth / 2;\n}\n\n/**\n *\n * restore new annotation position to original position based\n * on a map of [end of original annotation position ] to\n * [number of characters to move]\n *\n */\nexport function restorePos(\n  charMoveMap: Map<number, number>,\n  begin: number,\n  end: number\n) {\n  let actualBegin = -1;\n  let actualEnd = -1;\n  let accumulatedMove = 0;\n\n  const entries = Array.from(charMoveMap.entries()).sort((a, b) => a[0] - b[0]);\n  let previousAnnoEnd = -1;\n\n  for (const [annoEnd, annoMove] of entries) {\n    if (annoEnd + accumulatedMove >= begin && actualBegin === -1) {\n      if (\n        previousAnnoEnd !== -1 &&\n        previousAnnoEnd + accumulatedMove >= begin\n      ) {\n        actualBegin = previousAnnoEnd + 1;\n      } else {\n        actualBegin = begin - accumulatedMove;\n      }\n    }\n\n    if (annoEnd + accumulatedMove >= end && actualEnd === -1) {\n      if (previousAnnoEnd !== -1 && previousAnnoEnd + accumulatedMove >= end) {\n        actualEnd = previousAnnoEnd;\n      } else {\n        actualEnd = end - accumulatedMove;\n      }\n    }\n    accumulatedMove += annoMove;\n    previousAnnoEnd = annoEnd;\n  }\n\n  // The procedures above are intended to fix annotations inserted in between existing annotations.\n  // If we have a new mention that the offset is larger than all existing annotations, then the\n  // procedures above will not be activated (since annoEnd + accumulatedMove < begin or end)\n  //\n  // For these annotation, there begin and end should still be adjusted by the accumulatedMove amount.\n  // The following procedures try to achieve this.\n\n  // First check for undefined actualBegin (i.e. actualBegin === -1).\n  if (actualBegin === -1) {\n    // If actualBegin is not defined.\n    const lastAnnoEnd = entries[entries.length - 1][0];\n    if (begin > lastAnnoEnd + accumulatedMove) {\n      // If the new annotation is after those\n      actualBegin = begin - accumulatedMove;\n    } else {\n      console.error(\n        `Unknown causes for undefined actualBegin of surface begin \n        at ${begin}. Offset calculation may be wrong.`\n      );\n      actualBegin = begin;\n    }\n  }\n\n  // Then check for undefined actualEnd (i.e. actualEnd === -1).\n  // We check these separately, since there might be cases where the actualBegin is defined but the\n  //  actualEnd is not.\n  if (actualEnd === -1) {\n    const lastAnnoEnd = entries[entries.length - 1][0];\n    if (end > lastAnnoEnd + accumulatedMove) {\n      actualEnd = end - accumulatedMove;\n    } else {\n      console.error(\n        `Unknown causes for undefined actualBegin of surface begin \n        at ${begin}. Offset calculation may be wrong.`\n      );\n      actualEnd = end;\n    }\n  }\n\n  return [actualBegin, actualEnd];\n}\n\n/**\n *\n * calculate how many empty space need to insert for\n * each annotation, so that there is enough space\n * to show the annotation label and link label.\n *\n */\nfunction calculateSpaceMap(\n  annotationWithPosition: {\n    position: IAnnotationPosition;\n    annotation: IAnnotation;\n  }[],\n\n  linksWithPos: {\n    link: ILink;\n    fromEntryWithPos: {\n      position: IAnnotationPosition;\n      annotation: IAnnotation;\n    };\n\n    toEntryWithPos: {\n      position: IAnnotationPosition;\n      annotation: IAnnotation;\n    };\n    fromLinkX: number;\n    toLinkX: number;\n    fromLinkY: number;\n    toLinkY: number;\n  }[],\n  selectedLegendAttributeIds: string[]\n) {\n  const spaceMap: ISpaceMap = {};\n\n  linksWithPos.forEach(linkPos => {\n    const label = Object.keys(linkPos.link.attributes)\n      .filter(attrKey => {\n        return (\n          selectedLegendAttributeIds.indexOf(\n            attributeId(linkPos.link.legendId, attrKey)\n          ) > -1\n        );\n      })\n      .map(attrKey => linkPos.link.attributes[attrKey])\n      .join(',');\n\n    const pixelNeedForLinkLabel = getTextWidth(label, fontWidth);\n    const distance = Math.abs(linkPos.fromLinkX - linkPos.toLinkX);\n    const annotationWithPos =\n      linkPos.fromLinkX < linkPos.toLinkX\n        ? linkPos.fromEntryWithPos\n        : linkPos.toEntryWithPos;\n    const spaceToMove =\n      distance > pixelNeedForLinkLabel\n        ? 0\n        : Math.ceil((pixelNeedForLinkLabel - distance) / fontWidth);\n\n    if (spaceMap[annotationWithPos.annotation.id] === undefined) {\n      spaceMap[annotationWithPos.annotation.id] = {\n        annotationWithPos,\n        spaceToMove,\n      };\n    } else {\n      if (spaceToMove > spaceMap[annotationWithPos.annotation.id].spaceToMove) {\n        spaceMap[annotationWithPos.annotation.id] = {\n          annotationWithPos,\n          spaceToMove,\n        };\n      }\n    }\n  });\n\n  return spaceMap;\n}\n\n/**\n *\n * get a map [line (represented by height)]\n * to [links grouped in levels in that line],\n * all levels of links are empty in this function,\n * because it only use annotations.\n *\n * we use this to capture lines that don't has links\n * in it.\n *\n */\nfunction getLevelsFromJustAnnotations(\n  annotationWithPosition: {\n    position: IAnnotationPosition;\n    annotation: IAnnotation;\n  }[]\n): Record<string, ILinkWithPos[][]> {\n  const levels: any = {};\n  const set = new Set(\n    annotationWithPosition.map(ann => ann.position.rects[0].y)\n  );\n  for (const height of Array.from(set)) {\n    levels[height] = [];\n  }\n\n  return levels;\n}\n\n/**\n *\n * Find new line to insert by how many level is there,\n * we need this because level number don't directly\n * translate to number of new lines.\n *\n */\nfunction calculateLinesToInsertByLevelNum(\n  collapsedLinesIndex: number[],\n  lineIndex: number,\n  levelNum: number\n) {\n  return (\n    (collapsedLinesIndex.indexOf(lineIndex) === -1\n      ? Math.ceil(levelNum / 4)\n      : 0) + (lineIndex === 0 ? 1 : 3)\n  );\n}\n\n/**\n *\n * get first annotation from left to right in a line.\n *\n * TODO: there is a bug. When the first rect of the line is\n * the also a part of annotation in last line. This function\n * returns the second rect. However there seems no good way\n * to resolve this, because we don't know the exact cursor\n * to insert.\n *\n */\nfunction getAnnotationsByLine(\n  annotationWithPosition: {\n    position: IAnnotationPosition;\n    annotation: IAnnotation;\n  }[],\n  lineHeight: number\n) {\n  return annotationWithPosition\n    .filter(ann => ann.position.rects[0].y === lineHeight)\n    .sort((annA, annB) => {\n      return annA.position.rects[0].x - annB.position.rects[0].x;\n    });\n}\n\nfunction getTextWidth(text: string, fontWidth: number) {\n  const textUpperLen = text.split('').filter(c => c === c.toUpperCase()).length;\n  const textOtherLen = text.length - textUpperLen;\n  const padding = fontWidth * 2;\n\n  return textUpperLen * (fontWidth + 3) + textOtherLen * fontWidth + padding;\n}\n\n// https://stackoverflow.com/questions/13382516/getting-scroll-bar-width-using-javascript\nfunction getScrollbarWidth() {\n  // Creating invisible container\n  const outer = document.createElement('div');\n  outer.style.visibility = 'hidden';\n  outer.style.overflow = 'scroll'; // forcing scrollbar to appear\n  (outer.style as any).msOverflowStyle = 'scrollbar'; // needed for WinJS apps\n  document.body.appendChild(outer);\n\n  // Creating inner element and placing it in the container\n  const inner = document.createElement('div');\n  outer.appendChild(inner);\n\n  // Calculating difference between container's full width and the child width\n  const scrollbarWidth = outer.offsetWidth - inner.offsetWidth;\n\n  // Removing temporary elements from the DOM\n  outer.remove();\n\n  return scrollbarWidth;\n}\n","import React, {memo} from 'react';\nimport {IAnnotation, IAnnotationPosition} from '../lib/interfaces';\nimport {useTextViewerDispatch} from '../contexts/text-viewer.context';\nimport style from '../styles/Annotation.module.css';\n\nexport interface AnnotationProp {\n  annotation: IAnnotation;\n  isSelected: boolean;\n  isHighlighted: boolean;\n  legendColor: string;\n  position: IAnnotationPosition;\n  linkEditIsCreating: boolean;\n  linkEditIsDragging: boolean;\n  linkEditToEntryId: string | null;\n  linkEditFromEntryId: string | null;\n}\n\nfunction Annotation({\n  annotation,\n  isSelected,\n  isHighlighted,\n  legendColor,\n  position,\n  linkEditIsCreating,\n  linkEditIsDragging,\n  linkEditFromEntryId,\n  linkEditToEntryId,\n}: AnnotationProp) {\n  const dispatch = useTextViewerDispatch();\n\n  return (\n    <>\n      {position.rects.map((rect, i) => {\n        const isConnectPointActive =\n          (linkEditIsDragging || linkEditIsCreating) &&\n          linkEditFromEntryId === annotation.id;\n\n        return (\n          <div\n            key={i}\n            className={`${style.annotation_container}\n              ${\n                isHighlighted || isSelected\n                  ? style.annotation_container_selected\n                  : ''\n              }\n              `}\n            style={{\n              transform: `translate(${rect.x - 1}px,${rect.y}px)`,\n            }}\n            data-annotation-id={annotation.id}\n            onMouseEnter={() => {\n              if (!isHighlighted) {\n                dispatch({\n                  type: 'highlight-annotation',\n                  annotationId: annotation.id,\n                });\n              }\n\n              if (linkEditToEntryId !== annotation.id) {\n                dispatch({\n                  type: 'set-create-link-target',\n                  annotationId: annotation.id,\n                });\n              }\n            }}\n            onMouseLeave={() => {\n              dispatch({\n                type: 'unhighlight-annotation',\n              });\n              dispatch({\n                type: 'set-create-link-target',\n                annotationId: null,\n              });\n            }}\n          >\n            <div\n              className={`${style.annotation}`}\n              style={{\n                marginTop: -2,\n                height: rect.height,\n                width: rect.width + 2,\n                borderTopColor: legendColor,\n                borderTopWidth: 5,\n                borderTopStyle: 'solid',\n                background:\n                  isHighlighted || isSelected || isConnectPointActive\n                    ? legendColor\n                    : undefined,\n              }}\n              draggable={true}\n              onDragStart={e => {\n                e.dataTransfer.dropEffect = 'move';\n                e.dataTransfer.setData(\n                  'text/plain',\n                  JSON.stringify({\n                    type: 'drag-annotation',\n                    annotationId: annotation.id,\n                  })\n                );\n              }}\n              onClick={() => {\n                isSelected\n                  ? dispatch({\n                      type: 'deselect-annotation',\n                    })\n                  : dispatch({\n                      type: 'select-annotation',\n                      annotationId: annotation.id,\n                    });\n              }}\n            >\n              <div\n                className={`${style.annotation_inner_left}`}\n                style={{borderRightColor: legendColor}}\n              ></div>\n              <div\n                className={`${style.annotation_inner_right}`}\n                style={{borderLeftColor: legendColor}}\n              ></div>\n            </div>\n            <div\n              className={`${style.connect_point}\n              ${isConnectPointActive && style.connect_point_active}`}\n              style={{\n                display:\n                  linkEditFromEntryId === annotation.id ? 'block' : 'none',\n              }}\n              onMouseDown={() => {\n                dispatch({type: 'deselect-link'});\n                dispatch({type: 'deselect-annotation'});\n                dispatch({\n                  type: 'start-create-link',\n                  annotationId: annotation.id,\n                });\n              }}\n            >\n              <span className={style.add_icon}></span>\n            </div>\n          </div>\n        );\n      })}\n    </>\n  );\n}\n\nexport default memo(Annotation);\n","import React, {memo} from 'react';\nimport {ILink, IAnnotation, IAnnotationPosition} from '../lib/interfaces';\nimport {attributeId} from '../lib/utils';\nimport {useTextViewerDispatch} from '../contexts/text-viewer.context';\nimport style from '../styles/Link.module.css';\n\nexport interface LinkSingleLineProp {\n  linkWithPosition: {\n    link: ILink;\n    fromEntryWithPos: {\n      position: IAnnotationPosition;\n      annotation: IAnnotation;\n    };\n    toEntryWithPos: {\n      position: IAnnotationPosition;\n      annotation: IAnnotation;\n    };\n    fromLinkX: number;\n    toLinkX: number;\n    fromLinkY: number;\n    toLinkY: number;\n  };\n  isSelected: boolean;\n  isHightlighted: boolean;\n  isCollapsed: boolean;\n  linkHeight: Record<string, Record<string, number>>;\n  selectedLegendAttributeIds: string[];\n}\n\nconst lineMaskWidth = 8;\nconst lineMaskColor = 'none';\nconst textLinkDistance = 8;\nconst borderRadius = 8;\n\nfunction LinkSingleLine({\n  linkWithPosition,\n  isSelected,\n  isHightlighted,\n  isCollapsed,\n  linkHeight,\n  selectedLegendAttributeIds,\n}: LinkSingleLineProp) {\n  const dispatch = useTextViewerDispatch();\n\n  let borderColor = '#888';\n  if (isSelected || isHightlighted) {\n    borderColor = '#555';\n  }\n\n  let labelColor = '#666';\n  if (isSelected || isHightlighted) {\n    labelColor = '#333';\n  }\n\n  const borderWidth = isSelected || isHightlighted ? '2px' : '1px';\n  const zIndex = isSelected || isHightlighted ? 1 : 0;\n  const height = isCollapsed\n    ? textLinkDistance\n    : textLinkDistance +\n      linkHeight[linkWithPosition.link.id][linkWithPosition.fromLinkY];\n  const goLeft = linkWithPosition.fromLinkX > linkWithPosition.toLinkX;\n  const arrowRadiusAdjust = Math.max(borderRadius - height, 0) / 2;\n  const arrowPosition = {\n    x: goLeft\n      ? linkWithPosition.toLinkX - arrowRadiusAdjust\n      : linkWithPosition.toLinkX - 4 + arrowRadiusAdjust,\n    y: linkWithPosition.toLinkY - height - 2,\n  };\n  const linkLabelPosition = {\n    x:\n      Math.min(linkWithPosition.fromLinkX, linkWithPosition.toLinkX) +\n      Math.abs(linkWithPosition.fromLinkX - linkWithPosition.toLinkX) / 2,\n    y: linkWithPosition.toLinkY - height - 4,\n  };\n\n  const linkLabel = Object.keys(linkWithPosition.link.attributes)\n    .filter(attrKey => {\n      return (\n        selectedLegendAttributeIds.indexOf(\n          attributeId(linkWithPosition.link.legendId, attrKey)\n        ) > -1\n      );\n    })\n    .map(attrKey => linkWithPosition.link.attributes[attrKey])\n    .join(',');\n\n  return (\n    <div\n      className={'single-line-container'}\n      data-from-id={linkWithPosition.link.fromEntryId}\n      data-to-id={linkWithPosition.link.toEntryId}\n    >\n      <div\n        className={style.link_line}\n        style={{\n          height: height,\n          width: Math.abs(\n            linkWithPosition.fromLinkX - linkWithPosition.toLinkX\n          ),\n          position: 'absolute',\n          top: linkWithPosition.fromLinkY - height,\n          left: Math.min(linkWithPosition.fromLinkX, linkWithPosition.toLinkX),\n          border: '1px solid #aaa',\n          borderTopWidth: borderWidth,\n          borderLeftWidth: borderWidth,\n          borderRightWidth: borderWidth,\n          borderColor: borderColor,\n          borderTopLeftRadius: borderRadius,\n          borderTopRightRadius: borderRadius,\n          borderBottomWidth: '0px',\n          zIndex,\n        }}\n      ></div>\n\n      <div\n        onClick={() =>\n          dispatch({type: 'select-link', linkId: linkWithPosition.link.id})\n        }\n        onMouseEnter={() => {\n          dispatch({\n            type: 'highlight-link',\n            linkId: linkWithPosition.link.id,\n          });\n        }}\n        onMouseLeave={() => {\n          dispatch({type: 'unhighlight-link'});\n        }}\n        style={{\n          position: 'absolute',\n          width: Math.abs(\n            linkWithPosition.fromLinkX - linkWithPosition.toLinkX\n          ),\n          height: lineMaskWidth,\n          background: lineMaskColor,\n          top: linkWithPosition.fromLinkY - height - lineMaskWidth / 2,\n          left: Math.min(linkWithPosition.fromLinkX, linkWithPosition.toLinkX),\n        }}\n        className={style.link_event_mask}\n      ></div>\n\n      <div\n        onClick={() =>\n          dispatch({type: 'select-link', linkId: linkWithPosition.link.id})\n        }\n        onMouseEnter={() => {\n          dispatch({\n            type: 'highlight-link',\n            linkId: linkWithPosition.link.id,\n          });\n        }}\n        onMouseLeave={() => {\n          dispatch({type: 'unhighlight-link'});\n        }}\n        style={{\n          position: 'absolute',\n          width: lineMaskWidth,\n          background: lineMaskColor,\n          height: height,\n          top: linkWithPosition.fromLinkY - height,\n          left:\n            Math.min(linkWithPosition.fromLinkX, linkWithPosition.toLinkX) -\n            lineMaskWidth / 2,\n        }}\n        className={style.link_event_mask}\n      ></div>\n\n      <div\n        onClick={() =>\n          dispatch({type: 'select-link', linkId: linkWithPosition.link.id})\n        }\n        onMouseEnter={() => {\n          dispatch({\n            type: 'highlight-link',\n            linkId: linkWithPosition.link.id,\n          });\n        }}\n        onMouseLeave={() => {\n          dispatch({type: 'unhighlight-link'});\n        }}\n        style={{\n          position: 'absolute',\n          width: lineMaskWidth,\n          background: lineMaskColor,\n          height: height,\n          top: linkWithPosition.fromLinkY - height,\n          left:\n            Math.min(linkWithPosition.fromLinkX, linkWithPosition.toLinkX) +\n            Math.abs(linkWithPosition.fromLinkX - linkWithPosition.toLinkX) -\n            lineMaskWidth / 2,\n        }}\n        className={style.link_event_mask}\n      ></div>\n\n      <div\n        className={`${style.arrow}\n          ${(isSelected || isHightlighted) && style.arrow_large}`}\n        style={{\n          transformOrigin: 'center bottom',\n          transform: `\n                  rotate(\n                      ${goLeft ? '60deg' : '-60deg'})`,\n          position: 'absolute',\n          top: arrowPosition.y,\n          left: arrowPosition.x,\n          borderTopColor: borderColor,\n        }}\n      ></div>\n\n      {linkLabel && !isCollapsed ? (\n        <div\n          className={style.link_label}\n          style={{\n            transform: 'translate(-50%)',\n            position: 'absolute',\n            textAlign: goLeft ? 'left' : 'right',\n            top: `${linkLabelPosition.y}px`,\n            left: `${linkLabelPosition.x}px`,\n            color: labelColor,\n          }}\n        >\n          {linkLabel}\n        </div>\n      ) : null}\n    </div>\n  );\n}\n\nexport default memo(LinkSingleLine);\n","import React, {memo} from 'react';\nimport {ILink, IAnnotation, IAnnotationPosition} from '../lib/interfaces';\nimport {attributeId, shouldMultiLineGoLeft} from '../lib/utils';\nimport {useTextViewerDispatch} from '../contexts/text-viewer.context';\nimport style from '../styles/Link.module.css';\n\nexport interface LinkMultiLineProp {\n  linkWithPosition: {\n    link: ILink;\n    fromEntryWithPos: {\n      position: IAnnotationPosition;\n      annotation: IAnnotation;\n    };\n    toEntryWithPos: {\n      position: IAnnotationPosition;\n      annotation: IAnnotation;\n    };\n    fromLinkX: number;\n    toLinkX: number;\n    fromLinkY: number;\n    toLinkY: number;\n  };\n  isSelected: boolean;\n  isHightlighted: boolean;\n  linkHeight: Record<string, Record<string, number>>;\n  selectedLegendAttributeIds: string[];\n  lineHeights: number[];\n  collapsedLineIndexes: number[];\n  lineStartX: number;\n  lineWidth: number;\n}\n\nconst lineMaskWidth = 8;\nconst lineMaskColor = 'none';\nconst textLinkDistance = 8;\nconst borderRadius = 8;\n\nfunction LinkMultiLine({\n  linkWithPosition,\n  isSelected,\n  isHightlighted,\n  linkHeight,\n  lineHeights,\n  selectedLegendAttributeIds,\n  collapsedLineIndexes,\n  lineStartX,\n  lineWidth,\n}: LinkMultiLineProp) {\n  const dispatch = useTextViewerDispatch();\n\n  let borderColor = '#888';\n  if (isSelected || isHightlighted) {\n    borderColor = '#555';\n  }\n\n  let labelColor = '#666';\n  if (isSelected || isHightlighted) {\n    labelColor = '#333';\n  }\n\n  const borderWidth = isSelected || isHightlighted ? '2px' : '1px';\n  const zIndex = isSelected || isHightlighted ? 1 : 0;\n  const fromLineIndex = lineHeights.indexOf(linkWithPosition.fromLinkY);\n  const fromLineCollapsed = collapsedLineIndexes.indexOf(fromLineIndex) !== -1;\n  const fromLineHeight = fromLineCollapsed\n    ? textLinkDistance\n    : textLinkDistance +\n      linkHeight[linkWithPosition.link.id][linkWithPosition.fromLinkY];\n\n  const toLineIndex = lineHeights.indexOf(linkWithPosition.toLinkY);\n  const toLineCollapsed = collapsedLineIndexes.indexOf(toLineIndex) !== -1;\n  const toLineHeight = toLineCollapsed\n    ? textLinkDistance\n    : textLinkDistance +\n      linkHeight[linkWithPosition.link.id][linkWithPosition.toLinkY];\n\n  const goLeft = shouldMultiLineGoLeft(linkWithPosition, lineStartX, lineWidth);\n\n  const sideGap = 5;\n  const arrowRadiusAdjust = Math.max(borderRadius - toLineHeight, 0) / 2;\n\n  const arrowGoLeft = !goLeft;\n  const arrowPosition = {\n    x: arrowGoLeft\n      ? linkWithPosition.toLinkX - arrowRadiusAdjust\n      : linkWithPosition.toLinkX - 4 + arrowRadiusAdjust,\n    y: linkWithPosition.toLinkY - toLineHeight - 2,\n  };\n  const fromLineX = goLeft\n    ? Math.min(linkWithPosition.fromLinkX, lineStartX) - sideGap\n    : Math.min(linkWithPosition.fromLinkX, lineStartX + lineWidth);\n  const fromLineWidth = goLeft\n    ? Math.abs(linkWithPosition.fromLinkX - lineStartX) + sideGap\n    : Math.abs(linkWithPosition.fromLinkX - (lineStartX + lineWidth)) + sideGap;\n\n  const toLineX = goLeft\n    ? Math.min(linkWithPosition.toLinkX, lineStartX) - sideGap\n    : Math.min(linkWithPosition.toLinkX, lineStartX + lineWidth);\n  const toLineWidth = goLeft\n    ? Math.abs(linkWithPosition.toLinkX - lineStartX) + sideGap\n    : Math.abs(linkWithPosition.toLinkX - (lineStartX + lineWidth)) + sideGap;\n\n  const fromLinkLabelPosition = {\n    x: fromLineX + fromLineWidth / 2,\n    y: linkWithPosition.fromLinkY - fromLineHeight - 4,\n  };\n\n  const toLinkLabelPosition = {\n    x: toLineX + toLineWidth / 2,\n    y: linkWithPosition.toLinkY - toLineHeight - 4,\n  };\n\n  const linkLabel = Object.keys(linkWithPosition.link.attributes)\n    .filter(attrKey => {\n      return (\n        selectedLegendAttributeIds.indexOf(\n          attributeId(linkWithPosition.link.legendId, attrKey)\n        ) > -1\n      );\n    })\n    .map(attrKey => linkWithPosition.link.attributes[attrKey])\n    .join(',');\n\n  return (\n    <div\n      className=\"cross-line-container\"\n      data-from-id={linkWithPosition.link.fromEntryId}\n      data-to-id={linkWithPosition.link.toEntryId}\n    >\n      <div\n        className={style.link_line}\n        style={{\n          height: fromLineHeight,\n          width: fromLineWidth,\n          position: 'absolute',\n          top: linkWithPosition.fromLinkY - fromLineHeight,\n          left: fromLineX,\n          border: '1px solid #aaa',\n          borderColor: borderColor,\n          borderTopLeftRadius: goLeft ? 0 : borderRadius,\n          borderTopRightRadius: goLeft ? borderRadius : 0,\n          borderBottomWidth: 0,\n          borderTopWidth: borderWidth,\n          borderLeftWidth: goLeft ? 0 : borderWidth,\n          borderRightWidth: goLeft ? borderWidth : 0,\n          zIndex,\n        }}\n      ></div>\n\n      <div\n        className={style.link_line}\n        style={{\n          height: toLineHeight,\n          width: toLineWidth,\n          position: 'absolute',\n          top: linkWithPosition.toLinkY - toLineHeight,\n          left: toLineX,\n          border: '1px solid #aaa',\n          borderColor: borderColor,\n          borderTopLeftRadius: goLeft ? 0 : borderRadius,\n          borderTopRightRadius: goLeft ? borderRadius : 0,\n          borderBottomWidth: 0,\n          borderTopWidth: borderWidth,\n          borderLeftWidth: goLeft ? 0 : borderWidth,\n          borderRightWidth: goLeft ? borderWidth : 0,\n          zIndex,\n        }}\n      ></div>\n\n      <div\n        className={style.link_line}\n        style={{\n          height:\n            Math.abs(\n              linkWithPosition.toLinkY -\n                toLineHeight -\n                (linkWithPosition.fromLinkY - fromLineHeight)\n            ) + 1,\n          width: 1,\n          position: 'absolute',\n          top: Math.min(\n            linkWithPosition.toLinkY - toLineHeight,\n            linkWithPosition.fromLinkY - fromLineHeight\n          ),\n          left: goLeft\n            ? lineStartX - sideGap\n            : lineStartX + lineWidth + sideGap,\n          borderLeft: '1px solid #aaa',\n          borderLeftWidth: borderWidth,\n          borderColor: borderColor,\n          zIndex,\n        }}\n      ></div>\n\n      <div\n        onClick={() =>\n          dispatch({type: 'select-link', linkId: linkWithPosition.link.id})\n        }\n        onMouseEnter={() => {\n          dispatch({\n            type: 'highlight-link',\n            linkId: linkWithPosition.link.id,\n          });\n        }}\n        onMouseLeave={() => {\n          dispatch({type: 'unhighlight-link'});\n        }}\n        style={{\n          position: 'absolute',\n          width: fromLineWidth,\n          height: lineMaskWidth,\n          background: lineMaskColor,\n          top: linkWithPosition.fromLinkY - fromLineHeight - lineMaskWidth / 2,\n          left: fromLineX,\n        }}\n        className={style.link_event_mask}\n      ></div>\n\n      <div\n        onClick={() =>\n          dispatch({type: 'select-link', linkId: linkWithPosition.link.id})\n        }\n        onMouseEnter={() => {\n          dispatch({\n            type: 'highlight-link',\n            linkId: linkWithPosition.link.id,\n          });\n        }}\n        onMouseLeave={() => {\n          dispatch({type: 'unhighlight-link'});\n        }}\n        style={{\n          position: 'absolute',\n          width: toLineWidth,\n          height: lineMaskWidth,\n          background: lineMaskColor,\n          top: linkWithPosition.toLinkY - toLineHeight - lineMaskWidth / 2,\n          left: toLineX,\n        }}\n        className={style.link_event_mask}\n      ></div>\n\n      <div\n        onClick={() =>\n          dispatch({type: 'select-link', linkId: linkWithPosition.link.id})\n        }\n        onMouseEnter={() => {\n          dispatch({\n            type: 'highlight-link',\n            linkId: linkWithPosition.link.id,\n          });\n        }}\n        onMouseLeave={() => {\n          dispatch({type: 'unhighlight-link'});\n        }}\n        style={{\n          position: 'absolute',\n          width: lineMaskWidth,\n          background: lineMaskColor,\n          height: fromLineHeight,\n          top: linkWithPosition.fromLinkY - fromLineHeight,\n          left: fromLineX - lineMaskWidth / 2 + (goLeft ? fromLineWidth : 0),\n        }}\n        className={style.link_event_mask}\n      ></div>\n\n      <div\n        onClick={() =>\n          dispatch({type: 'select-link', linkId: linkWithPosition.link.id})\n        }\n        onMouseEnter={() => {\n          dispatch({\n            type: 'highlight-link',\n            linkId: linkWithPosition.link.id,\n          });\n        }}\n        onMouseLeave={() => {\n          dispatch({type: 'unhighlight-link'});\n        }}\n        style={{\n          position: 'absolute',\n          width: lineMaskWidth,\n          background: lineMaskColor,\n          height: toLineHeight,\n          top: linkWithPosition.toLinkY - toLineHeight,\n          left: toLineX - lineMaskWidth / 2 + (goLeft ? toLineWidth : 0),\n        }}\n        className={style.link_event_mask}\n      ></div>\n\n      <div\n        onClick={() =>\n          dispatch({type: 'select-link', linkId: linkWithPosition.link.id})\n        }\n        onMouseEnter={() => {\n          dispatch({\n            type: 'highlight-link',\n            linkId: linkWithPosition.link.id,\n          });\n        }}\n        onMouseLeave={() => {\n          dispatch({type: 'unhighlight-link'});\n        }}\n        style={{\n          height:\n            Math.abs(\n              linkWithPosition.toLinkY -\n                toLineHeight -\n                (linkWithPosition.fromLinkY - fromLineHeight)\n            ) + 1,\n          width: lineMaskWidth,\n          background: lineMaskColor,\n          position: 'absolute',\n          top: Math.min(\n            linkWithPosition.toLinkY - toLineHeight,\n            linkWithPosition.fromLinkY - fromLineHeight\n          ),\n          left: goLeft\n            ? lineStartX - sideGap\n            : lineStartX + lineWidth + sideGap - lineMaskWidth / 2,\n        }}\n        className={style.link_event_mask}\n      ></div>\n\n      <div\n        className={`${style.arrow}\n          ${(isSelected || isHightlighted) && style.arrow_large}`}\n        style={{\n          transformOrigin: 'center bottom',\n          transform: `\n              rotate(${arrowGoLeft ? '60deg' : '-60deg'})`,\n          position: 'absolute',\n          top: arrowPosition.y,\n          left: arrowPosition.x,\n        }}\n      ></div>\n\n      {fromLineCollapsed ? null : (\n        <div\n          className={style.link_label}\n          style={{\n            transform: 'translate(-50%)',\n            position: 'absolute',\n            textAlign: goLeft ? 'left' : 'right',\n            top: `${fromLinkLabelPosition.y}px`,\n            left: `${fromLinkLabelPosition.x}px`,\n            color: labelColor,\n          }}\n        >\n          {linkLabel}\n        </div>\n      )}\n\n      {toLineCollapsed ? null : (\n        <div\n          className={style.link_label}\n          style={{\n            transform: 'translate(-50%)',\n            position: 'absolute',\n            textAlign: goLeft ? 'left' : 'right',\n            top: `${toLinkLabelPosition.y}px`,\n            left: `${toLinkLabelPosition.x}px`,\n            color: labelColor,\n          }}\n        >\n          {linkLabel}\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default memo(LinkMultiLine);\n","import React, {memo} from 'react';\nimport {IAnnotationPosition, IAnnotation} from '../lib/interfaces';\nimport style from '../styles/AnnotationLabel.module.css';\nimport {\n  attributeId,\n  displayAttributeInline,\n  displayAttributeFloating,\n} from '../lib/utils';\n\nexport interface AnnotationLabelProp {\n  position: IAnnotationPosition;\n  annotation: IAnnotation;\n  isSelected: boolean;\n  selectedLegendAttributeIds: string[];\n}\n\nfunction AnnotationLabel({\n  position,\n  annotation,\n  isSelected,\n  selectedLegendAttributeIds,\n}: AnnotationLabelProp) {\n  const attrKeys = Object.keys(annotation.attributes).filter(attrKey => {\n    if (isSelected) {\n      return true;\n    } else {\n      return (\n        selectedLegendAttributeIds.indexOf(\n          attributeId(annotation.legendId, attrKey)\n        ) > -1\n      );\n    }\n  });\n\n  if (!attrKeys.length) {\n    return null;\n  }\n\n  return (\n    <div\n      key={annotation.id}\n      className={isSelected ? style.annotation_attr_container_selected : ''}\n      style={{\n        position: 'absolute',\n        zIndex: isSelected ? 30 : 0,\n        transform: 'translate(-50%, 0)',\n        top: position.rects[0].y + 20,\n        left: position.rects[0].x + position.rects[0].width / 2,\n        fontSize: 10,\n        backgroundColor: 'white',\n      }}\n    >\n      {position.rects.map((rect, i) => {\n        return attrKeys.map((attrKey, j) => {\n          return (\n            <div\n              className={\n                isSelected\n                  ? style.annotation_attr_rect_selected\n                  : style.annotation_attr_rect\n              }\n              key={attrKey + i}\n              style={{\n                ...(!isSelected && {\n                  top: j * 2,\n                  left: j * 2,\n                }),\n              }}\n            >\n              {isSelected ? (\n                <>\n                  <span className={style.annotation_attr_label}>{attrKey}</span>\n                  <span className={style.annotation_attr_value}>\n                    {displayAttributeFloating(annotation.attributes[attrKey])}\n                  </span>\n                </>\n              ) : (\n                displayAttributeInline(annotation.attributes[attrKey])\n              )}\n            </div>\n          );\n        });\n      })}\n    </div>\n  );\n}\n\nexport default memo(AnnotationLabel);\n","import React from 'react';\nimport {IPos} from '../lib/interfaces';\nimport style from '../styles/LineWithArrow.module.css';\n\nexport interface LineWithArrowProp {\n  fromPos: IPos;\n  toPos: IPos;\n}\n\nexport default function LineWithArrow({fromPos, toPos}: LineWithArrowProp) {\n  const x = fromPos.x;\n  const y = fromPos.y;\n\n  const width = toPos.x - x;\n  const height = toPos.y - y;\n\n  let rotate = (Math.atan(height / width) * 180) / Math.PI;\n  if (width === 0) {\n    if (height > 0) {\n      rotate = -90;\n    } else {\n      rotate = 90;\n    }\n  } else if (width < 0) {\n    if (height > 0) {\n      rotate += 180;\n    } else {\n      rotate -= 180;\n    }\n  }\n\n  return (\n    <div\n      className={style.link_edit_connector}\n      style={{\n        position: 'absolute',\n        top: y,\n        left: x,\n        transformOrigin: '0 0',\n        transform: `rotate(${rotate}deg)`,\n        width: Math.sqrt(width * width + height * height) - 2,\n        height: 1,\n      }}\n    >\n      <span className={style.link_drag_arrow}></span>\n    </div>\n  );\n}\n","import React, {useState, useEffect, memo} from 'react';\nimport {IAnnotationPosition} from '../lib/interfaces';\nimport {useTextViewerDispatch} from '../contexts/text-viewer.context';\nimport LineWithArrow from './LineWithArrow';\n\nexport interface LinkEditConnectorProp {\n  position: IAnnotationPosition;\n  offsetX: number;\n  offsetY: number;\n}\n\nfunction LinkEditConnector({\n  position,\n  offsetX,\n  offsetY,\n}: LinkEditConnectorProp) {\n  const dispatch = useTextViewerDispatch();\n  const [pos, setPos] = useState({\n    x: 0,\n    y: 0,\n  });\n\n  useEffect(() => {\n    let moved = false;\n\n    function updatePos(e: MouseEvent) {\n      moved = true;\n      requestAnimationFrame(() => {\n        setPos({x: e.clientX, y: e.clientY});\n      });\n    }\n\n    function endMove() {\n      dispatch({type: 'stop-create-link-dragging', hasMoved: moved});\n    }\n\n    window.addEventListener('mousemove', updatePos);\n    window.addEventListener('mouseup', endMove);\n\n    return () => {\n      window.removeEventListener('mousemove', updatePos);\n      window.removeEventListener('mouseup', endMove);\n    };\n  }, [dispatch]);\n\n  const isMoved = pos.x !== 0 || pos.y !== 0;\n  if (!isMoved) return null;\n\n  const x = position.rects[0].x + position.rects[0].width;\n  const y = position.rects[0].y;\n\n  const fromPos = {\n    x,\n    y,\n  };\n\n  const toPos = {\n    x: pos.x - offsetX,\n    y: pos.y - offsetY,\n  };\n\n  return <LineWithArrow fromPos={fromPos} toPos={toPos} />;\n}\n\nexport default memo(LinkEditConnector);\n","import React, {useRef, useEffect, useMemo} from 'react';\nimport style from '../styles/TextArea.module.css';\nimport {\n  ISinglePack,\n  IRect,\n  IEntryDefinition,\n  IAnnotationPosition,\n  IAnnotation,\n  ILink,\n} from '../lib/interfaces';\nimport {calculateLinesLevels, calculateLinkHeight} from '../lib/utils';\nimport {\n  spaceOutText,\n  mergeLinkWithPosition,\n  mergeAnnotationWithPosition,\n} from '../lib/text-spacer';\nimport Annotation from './Annotation';\nimport LinkSingleLine from './LinkSingleLine';\nimport LinkMultiLine from './LinkMultiLine';\nimport AnnotationLabel from './AnnotationLabel';\nimport LinkEditConnector from './LinkEditConnector';\nimport {\n  useTextViewerState,\n  useTextViewerDispatch,\n} from '../contexts/text-viewer.context';\nimport {debounce} from 'lodash-es';\nimport LineWithArrow from './LineWithArrow';\n\nexport interface TextAreaProp {\n  textPack: ISinglePack;\n  annotationLegendsColored: (IEntryDefinition & {color: string})[];\n}\n\nfunction TextArea({textPack, annotationLegendsColored}: TextAreaProp) {\n  let {annotations, text} = textPack;\n  const {links} = textPack;\n  const textNodeEl = useRef<HTMLDivElement>(null);\n  const textAreaEl = useRef<HTMLDivElement>(null);\n\n  const dispatch = useTextViewerDispatch();\n  const {\n    selectedLegendIds,\n    selectedLegendAttributeIds,\n\n    spacingCalculated,\n    spacedText,\n    collapsedLineIndexes,\n    annotationPositions,\n    textNodeWidth,\n\n    selectedAnnotationId,\n    highlightedAnnotationIds,\n    halfSelectedAnnotationIds,\n\n    selectedLinkId,\n    highlightedLinkIds,\n    halfSelectedLinkIds,\n\n    linkEditFromEntryId,\n    linkEditToEntryId,\n    linkEditIsCreating,\n    linkEditIsDragging,\n\n    annoEditIsCreating,\n    annoEditCursorBegin,\n    annoEditCursorEnd,\n\n    jumpToAnnotation,\n\n    selectedScopeId,\n    selectedScopeIndex,\n  } = useTextViewerState();\n\n  if (selectedScopeId !== null) {\n    const scopeAnnotations = annotations.filter(\n      ann => ann.legendId === selectedScopeId\n    );\n    if (scopeAnnotations.length > 0) {\n      const currScopeAnnotation = scopeAnnotations[selectedScopeIndex];\n\n      text = text.substring(\n        currScopeAnnotation.span.begin,\n        currScopeAnnotation.span.end\n      );\n      annotations = annotations\n        .filter(\n          ann =>\n            ann.span.begin >= currScopeAnnotation.span.begin &&\n            ann.span.end <= currScopeAnnotation.span.end\n        )\n        .map(ann => {\n          const scoppedSpan = {\n            begin: ann.span.begin - currScopeAnnotation.span.begin,\n            end: ann.span.end - currScopeAnnotation.span.begin,\n          };\n          return {\n            ...ann,\n            span: scoppedSpan,\n          };\n        });\n    }\n  }\n\n  useEffect(() => {\n    function calculateTextSpace(\n      annotations: IAnnotation[],\n      text: string,\n      links: ILink[],\n      selectedLegendIds: string[],\n      selectedLegendAttributeIds: string[],\n      spacingCalculated: boolean,\n      collapsedLinesIndex: number[]\n    ) {\n      if (!spacingCalculated) {\n        const {\n          spacedText,\n          charMoveMap,\n          annotationPositions,\n          textNodeWidth,\n        } = spaceOutText(\n          annotations,\n          text,\n          links,\n          selectedLegendIds,\n          selectedLegendAttributeIds,\n          collapsedLinesIndex\n        );\n\n        dispatch({\n          type: 'set-spaced-annotation-span',\n          spacedText,\n          charMoveMap,\n          annotationPositions,\n          textNodeWidth,\n        });\n      }\n    }\n\n    const handleWindowResize = debounce(() => {\n      dispatch({\n        type: 'reset-calculated-text-space',\n      });\n    }, 300);\n\n    calculateTextSpace(\n      annotations,\n      text,\n      links,\n      selectedLegendIds,\n      selectedLegendAttributeIds,\n      spacingCalculated,\n      collapsedLineIndexes\n    );\n\n    if (spacingCalculated && jumpToAnnotation !== null) {\n      const el = document.querySelector(\n        `[data-annotation-id=\"${jumpToAnnotation}\"]`\n      );\n\n      if (el) {\n        el.scrollIntoView({behavior: 'smooth', block: 'center'});\n      }\n\n      dispatch({\n        type: 'jump-to-annotation-done',\n      });\n    }\n\n    window.addEventListener('resize', handleWindowResize);\n\n    return () => {\n      window.removeEventListener('resize', handleWindowResize);\n    };\n  }, [\n    annotations,\n    text,\n    links,\n    selectedLegendIds,\n    selectedLegendAttributeIds,\n    spacingCalculated,\n    dispatch,\n    collapsedLineIndexes,\n    jumpToAnnotation,\n  ]);\n\n  const annotationsWithPosition = useMemo(() => {\n    return mergeAnnotationWithPosition(annotationPositions, annotations).filter(\n      ann => selectedLegendIds.indexOf(ann.annotation.legendId) > -1\n    );\n  }, [annotationPositions, annotations, selectedLegendIds]);\n\n  const linksWithPos = useMemo(() => {\n    return mergeLinkWithPosition(links, annotationsWithPosition).filter(\n      link => selectedLegendIds.indexOf(link.link.legendId) > -1\n    );\n  }, [links, annotationsWithPosition, selectedLegendIds]);\n\n  const lineStartX = 0; // textNodeDimension.x;\n  const lineWidth = textNodeWidth; // textNodeDimension.width;\n  const linkGap = 8;\n\n  const linesLevels = useMemo(() => {\n    return calculateLinesLevels(linksWithPos, lineStartX, lineWidth);\n  }, [linksWithPos, lineStartX, lineWidth]);\n\n  const linkHeight = useMemo(() => {\n    return calculateLinkHeight(linesLevels, linkGap);\n  }, [linesLevels, linkGap]);\n\n  const lineHeights = Object.keys(linesLevels).map(l => +l);\n\n  const textAreaClass = `text_area_container ${style.text_area_container} ${\n    spacedText ? style.text_area_container_visible : ''\n  }`;\n\n  useEffect(() => {\n    function handleTextMouseUp(e: MouseEvent) {\n      if (annoEditIsCreating) {\n        const selection = window.getSelection();\n\n        if (selection) {\n          if (selection.type === 'Range') {\n            const begin = Math.min(\n              selection.anchorOffset,\n              selection.focusOffset\n            );\n            const end = Math.max(selection.anchorOffset, selection.focusOffset);\n            dispatch({\n              type: 'annotation-edit-select-text',\n              begin,\n              end,\n            });\n            selection.empty();\n          } else if (\n            selection.type === 'Caret' &&\n            e.target === textAreaEl.current\n          ) {\n            if (annoEditCursorBegin === null) {\n              dispatch({\n                type: 'annotation-edit-set-begin',\n                begin: selection.anchorOffset,\n              });\n            } else {\n              dispatch({\n                type: 'annotation-edit-set-end',\n                end: selection.anchorOffset,\n              });\n            }\n          }\n        }\n      }\n    }\n\n    window.addEventListener('mouseup', handleTextMouseUp);\n    return () => {\n      window.removeEventListener('mouseup', handleTextMouseUp);\n    };\n  }, [dispatch, annoEditIsCreating, annoEditCursorBegin, textAreaEl]);\n\n  let annoEditRangeRects: IRect[] = [];\n  let annoEditBeginRect: IRect | null = null;\n  let annoEditEndRect: IRect | null = null;\n  if (\n    annoEditCursorBegin !== null &&\n    textNodeEl.current &&\n    textAreaEl.current\n  ) {\n    const selectionIndicators = getTextSelectionIndicators(\n      annoEditCursorBegin,\n      annoEditCursorEnd,\n      textNodeEl.current,\n      textAreaEl.current\n    );\n\n    annoEditRangeRects = selectionIndicators.rangeRects;\n    annoEditBeginRect = selectionIndicators.beginRect;\n    annoEditEndRect = selectionIndicators.endRect;\n  }\n\n  return (\n    <div\n      className={textAreaClass}\n      style={{\n        userSelect: linkEditIsCreating ? 'none' : 'auto',\n        cursor: annoEditIsCreating ? 'text' : 'initial',\n      }}\n      ref={textAreaEl}\n    >\n      <div className={style.text_node_container} ref={textNodeEl}>\n        {spacedText || text}\n      </div>\n\n      <div\n        className={style.annotations_container}\n        style={{\n          pointerEvents: annoEditIsCreating ? 'none' : 'initial',\n        }}\n      >\n        {annotationsWithPosition.map((ann, i) => {\n          const legend = annotationLegendsColored.find(\n            legend => legend.entryName === ann.annotation.legendId\n          );\n\n          if (!legend) {\n            return null;\n          }\n\n          return (\n            <Annotation\n              key={i}\n              annotation={ann.annotation}\n              isSelected={ann.annotation.id === selectedAnnotationId}\n              isHighlighted={\n                highlightedAnnotationIds.indexOf(ann.annotation.id) > -1 ||\n                halfSelectedAnnotationIds.indexOf(ann.annotation.id) > -1\n              }\n              legendColor={legend.color}\n              position={ann.position}\n              linkEditIsCreating={linkEditIsCreating}\n              linkEditIsDragging={linkEditIsDragging}\n              linkEditFromEntryId={linkEditFromEntryId}\n              linkEditToEntryId={linkEditToEntryId}\n            />\n          );\n        })}\n      </div>\n\n      <div className=\"ann_edit_rects_container\">\n        {annoEditRangeRects.map((rect, i) => {\n          return (\n            <div\n              key={i}\n              className={style.ann_edit_rect}\n              style={{\n                transform: `translate(${rect.x}px,${rect.y}px)`,\n                pointerEvents: 'none',\n                background: '#555',\n                opacity: 0.3,\n                height: rect.height,\n                width: rect.width,\n              }}\n            ></div>\n          );\n        })}\n\n        {annoEditBeginRect && (\n          <div\n            className={style.annotation_text_selection_cursor}\n            style={{\n              transform: `translate(${annoEditBeginRect.x}px,${annoEditBeginRect.y}px)`,\n              pointerEvents: 'none',\n              height: annoEditBeginRect.height,\n              width: annoEditBeginRect.width,\n            }}\n          >\n            <span className={style.cursor}></span>\n          </div>\n        )}\n        {annoEditEndRect && (\n          <div\n            className={style.annotation_text_selection_cursor}\n            style={{\n              transform: `translate(${annoEditEndRect.x}px,${annoEditEndRect.y}px)`,\n              pointerEvents: 'none',\n              height: annoEditEndRect.height,\n              width: annoEditEndRect.width,\n            }}\n          >\n            <span className={style.cursor}></span>\n          </div>\n        )}\n      </div>\n\n      <div\n        className=\"annotation_line_toggles_container\"\n        style={{\n          pointerEvents: annoEditIsCreating ? 'none' : 'initial',\n        }}\n      >\n        {lineHeights.map((lineHeight, i) => {\n          function collapse() {\n            dispatch({\n              type: 'collapse-line',\n              lineIndex: i,\n            });\n          }\n          function uncollapse() {\n            dispatch({\n              type: 'uncollapse-line',\n              lineIndex: i,\n            });\n          }\n          const isCollapsed = collapsedLineIndexes.indexOf(i) > -1;\n\n          return (\n            <button\n              key={i}\n              onClick={isCollapsed ? uncollapse : collapse}\n              className={style.annotation_line_toggle}\n              style={{top: lineHeight}}\n            >\n              {isCollapsed ? '+' : '-'}\n            </button>\n          );\n        })}\n      </div>\n\n      <div\n        className=\"annotation_label_container\"\n        style={{\n          pointerEvents: annoEditIsCreating ? 'none' : 'initial',\n        }}\n      >\n        {annotationsWithPosition.map(ann => {\n          const isSelected = ann.annotation.id === selectedAnnotationId;\n\n          return (\n            <AnnotationLabel\n              key={ann.annotation.id}\n              position={ann.position}\n              annotation={ann.annotation}\n              isSelected={isSelected}\n              selectedLegendAttributeIds={selectedLegendAttributeIds}\n            />\n          );\n        })}\n      </div>\n\n      <div\n        className={style.links_container}\n        style={{\n          pointerEvents: annoEditIsCreating ? 'none' : 'initial',\n        }}\n      >\n        {linksWithPos.map(linkPos => {\n          const isLinkSelected = selectedLinkId === linkPos.link.id;\n          const isLinkHightlighted =\n            highlightedLinkIds.includes(linkPos.link.id) ||\n            halfSelectedLinkIds.includes(linkPos.link.id);\n\n          if (linkPos.fromLinkY === linkPos.toLinkY) {\n            const lineIndex = lineHeights.indexOf(linkPos.fromLinkY);\n            const isLineCollapsed =\n              collapsedLineIndexes.indexOf(lineIndex) !== -1;\n\n            return (\n              <LinkSingleLine\n                key={linkPos.link.id}\n                linkWithPosition={linkPos}\n                isSelected={isLinkSelected}\n                isHightlighted={isLinkHightlighted}\n                isCollapsed={isLineCollapsed}\n                linkHeight={linkHeight}\n                selectedLegendAttributeIds={selectedLegendAttributeIds}\n              />\n            );\n          } else {\n            return (\n              <LinkMultiLine\n                key={linkPos.link.id}\n                linkWithPosition={linkPos}\n                isSelected={isLinkSelected}\n                isHightlighted={isLinkHightlighted}\n                linkHeight={linkHeight}\n                selectedLegendAttributeIds={selectedLegendAttributeIds}\n                collapsedLineIndexes={collapsedLineIndexes}\n                lineHeights={lineHeights}\n                lineStartX={lineStartX}\n                lineWidth={lineWidth}\n              />\n            );\n          }\n        })}\n      </div>\n\n      <ConnectorContainer\n        linkEditIsDragging={linkEditIsDragging}\n        textNodeEl={textNodeEl.current}\n        annotationsWithPosition={annotationsWithPosition}\n        linkEditFromEntryId={linkEditFromEntryId}\n      />\n      <LineWithArrowContainer\n        linkEditIsCreating={linkEditIsCreating}\n        linkEditIsDragging={linkEditIsDragging}\n        linkEditFromEntryId={linkEditFromEntryId}\n        linkEditToEntryId={linkEditToEntryId}\n        annotationsWithPosition={annotationsWithPosition}\n      />\n    </div>\n  );\n}\n\nfunction LineWithArrowContainer({\n  linkEditIsCreating,\n  linkEditIsDragging,\n  linkEditFromEntryId,\n  linkEditToEntryId,\n  annotationsWithPosition,\n}: {\n  linkEditIsCreating: boolean;\n  linkEditIsDragging: boolean;\n  linkEditFromEntryId: string | null;\n  linkEditToEntryId: string | null;\n  annotationsWithPosition: {\n    position: IAnnotationPosition;\n    annotation: IAnnotation;\n  }[];\n}) {\n  if (\n    linkEditIsCreating &&\n    !linkEditIsDragging &&\n    linkEditFromEntryId &&\n    linkEditToEntryId\n  ) {\n    const startAnnotation = annotationsWithPosition.find(\n      link => link.annotation.id === linkEditFromEntryId\n    );\n\n    const endAnnotation = annotationsWithPosition.find(\n      link => link.annotation.id === linkEditToEntryId\n    );\n\n    if (!startAnnotation || !endAnnotation) return null;\n\n    const fromPos = {\n      x:\n        startAnnotation.position.rects[0].x +\n        startAnnotation.position.rects[0].width,\n      y: startAnnotation.position.rects[0].y,\n    };\n\n    const toPos = {\n      x:\n        endAnnotation.position.rects[0].x +\n        endAnnotation.position.rects[0].width / 2,\n      y: endAnnotation.position.rects[0].y,\n    };\n\n    return (\n      <div className={style.link_edit_container}>\n        <LineWithArrow fromPos={fromPos} toPos={toPos} />\n      </div>\n    );\n  } else {\n    return null;\n  }\n}\n\nfunction ConnectorContainer({\n  linkEditIsDragging,\n  textNodeEl,\n  annotationsWithPosition,\n  linkEditFromEntryId,\n}: {\n  linkEditIsDragging: boolean;\n  textNodeEl: HTMLDivElement | null;\n  linkEditFromEntryId: string | null;\n  annotationsWithPosition: {\n    position: IAnnotationPosition;\n    annotation: IAnnotation;\n  }[];\n}) {\n  if (!linkEditIsDragging) {\n    return null;\n  }\n\n  if (!textNodeEl) {\n    return null;\n  }\n\n  const textNodeRect = textNodeEl.getBoundingClientRect();\n  const startAnnotation = annotationsWithPosition.find(\n    link => link.annotation.id === linkEditFromEntryId\n  );\n\n  if (!startAnnotation) return null;\n\n  return (\n    <div className={style.link_edit_container}>\n      <LinkEditConnector\n        // annotation={startAnnotation}\n        position={startAnnotation.position}\n        // fromEntryId={linkEditFromEntryId}\n        offsetX={textNodeRect.left}\n        offsetY={textNodeRect.top}\n      />\n    </div>\n  );\n}\n\nfunction getTextSelectionIndicators(\n  begin: number,\n  end: number | null,\n  textNodeEl: HTMLDivElement,\n  textAreaEl: HTMLDivElement\n): {\n  rangeRects: IRect[];\n  beginRect: IRect;\n  endRect: IRect | null;\n} {\n  if (end !== null) {\n    const textNode = textNodeEl && textNodeEl.childNodes[0];\n    const textAreaRect = textAreaEl.getBoundingClientRect();\n\n    const range = document.createRange();\n    const beginRange = document.createRange();\n    const endRange = document.createRange();\n\n    range.setStart(textNode, begin);\n    range.setEnd(textNode, end);\n    const rects = Array.from(range.getClientRects() as DOMRectList);\n    const annoEditTextSelectionRect = rects.map(rect => ({\n      x: rect.x - textAreaRect.left,\n      y: rect.y - textAreaRect.top,\n      width: rect.width,\n      height: rect.height,\n    }));\n\n    beginRange.setStart(textNode, begin);\n    beginRange.setEnd(textNode, begin);\n    const beginRect = Array.from(beginRange.getClientRects() as DOMRectList)[0];\n\n    endRange.setStart(textNode, end);\n    endRange.setEnd(textNode, end);\n    const endRect = Array.from(endRange.getClientRects() as DOMRectList)[0];\n\n    return {\n      rangeRects: annoEditTextSelectionRect,\n      beginRect: {\n        x: beginRect.x - textAreaRect.left,\n        y: beginRect.y - textAreaRect.top,\n        width: beginRect.width,\n        height: beginRect.height,\n      },\n      endRect: {\n        x: endRect.x - textAreaRect.left,\n        y: endRect.y - textAreaRect.top,\n        width: endRect.width,\n        height: endRect.height,\n      },\n    };\n  } else {\n    const textNode = textNodeEl && textNodeEl.childNodes[0];\n    const textAreaRect = textAreaEl.getBoundingClientRect();\n\n    const beginRange = document.createRange();\n\n    beginRange.setStart(textNode, begin);\n    beginRange.setEnd(textNode, begin);\n    const beginRect = Array.from(beginRange.getClientRects() as DOMRectList)[0];\n\n    return {\n      rangeRects: [],\n      beginRect: {\n        x: beginRect.x - textAreaRect.left,\n        y: beginRect.y - textAreaRect.top,\n        width: beginRect.width,\n        height: beginRect.height,\n      },\n      endRect: null,\n    };\n  }\n}\n\nexport default TextArea;\n","import React from 'react';\nimport {IOntology, ISelectOption, IScopeConfigs} from '../lib/interfaces';\nimport {isAvailableScope, isEntryAnnotation, shortId} from '../lib/utils';\nimport Select from 'react-select';\nimport style from '../styles/ScopeSelectorProp.module.css';\nimport {useTextViewerDispatch} from '../contexts/text-viewer.context';\n\nexport type ScopeSelectorProp = {\n  ontology: IOntology;\n  selectedScopeId: string | null;\n  scopeConfig: IScopeConfigs;\n};\n\nexport default function ScopeSelector({\n  ontology,\n  selectedScopeId,\n  scopeConfig,\n}: ScopeSelectorProp) {\n  const dispatch = useTextViewerDispatch();\n  const legendTypeOptions: {\n    value: string | null;\n    label: string;\n  }[] = ontology.definitions\n    .filter(entry => {\n      return (\n        isEntryAnnotation(ontology, entry.entryName) &&\n        isAvailableScope(scopeConfig, entry.entryName)\n      );\n    })\n    .map(def => {\n      return {\n        value: def.entryName,\n        label: shortId(def.entryName) || '',\n      };\n    });\n\n  legendTypeOptions.unshift({value: null, label: 'Full text'});\n\n  const selectedLegendTypeOptions = legendTypeOptions.find(legendType => {\n    return selectedScopeId === legendType.value;\n  });\n\n  return (\n    <Select\n      className={style.input}\n      value={selectedLegendTypeOptions}\n      onChange={item => {\n        dispatch({\n          type: 'set-scope',\n          scopeId: (item as ISelectOption).value,\n        });\n      }}\n      options={legendTypeOptions}\n    />\n  );\n}\n","import React, {useEffect, useState} from 'react';\nimport Select from 'react-select';\nimport {\n  useTextViewerDispatch,\n  useTextViewerState,\n  getState,\n} from '../contexts/text-viewer.context';\nimport style from '../styles/CreateBox.module.css';\nimport {\n  IOntology,\n  ISelectOption,\n  IAnnotation,\n  IConstraint,\n} from '../lib/interfaces';\nimport {shortId, isEntryLink} from '../lib/utils';\nimport {OnEventType} from './TextViewer';\n\nexport interface LinkCreateBoxProp {\n  fromEntryId: string | null;\n  toEntryId: string | null;\n  ontology: IOntology;\n  onEvent?: OnEventType;\n}\n\nexport default function LinkCreateBox({\n  fromEntryId,\n  toEntryId,\n  ontology,\n  onEvent,\n}: LinkCreateBoxProp) {\n  const dispatch = useTextViewerDispatch();\n  const {linkEditSelectedLegendId, textPack} = useTextViewerState();\n  const [slideInAnimated, setSlideInAnimated] = useState(false);\n  const [flashAnimated, setFlashAnimated] = useState(false);\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const [enteredAttribute, setEnteredAttribute] = useState<any>({});\n\n  useEffect(() => {\n    setSlideInAnimated(true);\n  }, []);\n\n  useEffect(() => {\n    setTimeout(() => {\n      setFlashAnimated(true);\n    }, 100);\n\n    return () => {\n      setFlashAnimated(false);\n    };\n  }, [toEntryId]);\n\n  const selectedLegendDefinition = ontology.definitions.find(def => {\n    return def.entryName === linkEditSelectedLegendId;\n  });\n\n  const isAddEnabled = fromEntryId && toEntryId && linkEditSelectedLegendId;\n\n  function renderLegendSelect() {\n    if (!fromEntryId || !toEntryId || !textPack) {\n      return null;\n    }\n    const fromEntry = textPack.annotations.find(\n      ann => ann.id === fromEntryId\n    ) as IAnnotation;\n    const toEntry = textPack.annotations.find(\n      ann => ann.id === toEntryId\n    ) as IAnnotation;\n\n    const legendTypeOptions = ontology.definitions\n      .filter(entry => {\n        return isEntryLink(ontology, entry.entryName);\n      })\n      // filter by constraint\n      .filter(entry => {\n        const constraints = ontology.constraints[entry.entryName];\n        if (!constraints) return true;\n\n        const matchedConstraint = constraints.find(constraint =>\n          matchLinkConstraint(constraint, fromEntry, toEntry)\n        );\n\n        return !!matchedConstraint;\n      })\n      .map(def => {\n        return {\n          value: def.entryName,\n          label: shortId(def.entryName),\n        };\n      });\n\n    const selectedLegendTypeOption = legendTypeOptions.find(legendType => {\n      return linkEditSelectedLegendId === legendType.value;\n    });\n\n    return (\n      <div className={style.legend_type_container}>\n        <div className={style.legend_type_title}>Legend Type</div>\n\n        {legendTypeOptions.length ? (\n          <Select\n            value={selectedLegendTypeOption}\n            onChange={item => {\n              const selectedItem = item as ISelectOption;\n              dispatch({\n                type: 'link-edit-select-legend-type',\n                legendId: selectedItem.value,\n              });\n            }}\n            options={legendTypeOptions}\n          />\n        ) : (\n          'No options'\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <div\n      className={`${style.create_box}\n      ${slideInAnimated && style.slide_in_animated}`}\n    >\n      <div className={style.create_entry_container}>\n        <div className={style.create_title}>Parent</div>\n        <div\n          className={style.create_id}\n          onClick={() => {\n            // only allow to select when link is select is created\n            if (fromEntryId && toEntryId) {\n              dispatch({\n                type: 'select-annotation',\n                annotationId: fromEntryId,\n              });\n            }\n          }}\n        >\n          {fromEntryId ? shortId(fromEntryId) : ''}\n        </div>\n      </div>\n\n      <div\n        className={`${style.create_entry_container}\n          ${\n            flashAnimated ? style.flash_animated_on : style.flash_animated_off\n          }`}\n      >\n        <div className={style.create_title}>Child</div>\n        <div\n          className={`${style.create_id}\n          ${!toEntryId && style.to_be_select}`}\n          onClick={() => {\n            if (fromEntryId && toEntryId) {\n              dispatch({\n                type: 'select-annotation',\n                annotationId: toEntryId,\n              });\n            }\n          }}\n        >\n          {toEntryId ? shortId(toEntryId) : '[Click annotation to select]'}\n        </div>\n      </div>\n\n      {renderLegendSelect()}\n\n      {selectedLegendDefinition &&\n        selectedLegendDefinition.attributes &&\n        selectedLegendDefinition.attributes.length && (\n          <div className={style.legend_attributes}>\n            {(selectedLegendDefinition.attributes || []).map(attr => {\n              return (\n                <div className={style.legend_attribute_item} key={attr.name}>\n                  <div className={style.legend_attribute_item_title}>\n                    {attr.name}\n                  </div>\n                  <div>\n                    <input\n                      type=\"text\"\n                      value={enteredAttribute[attr.name] || ''}\n                      onChange={e =>\n                        setEnteredAttribute({\n                          ...enteredAttribute,\n                          [attr.name]: e.target.value,\n                        })\n                      }\n                    />\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n\n      <div className={style.buttons}>\n        <button\n          onClick={() => {\n            dispatch({\n              type: 'cancel-create-link',\n            });\n          }}\n        >\n          Cancel\n        </button>\n        <button\n          onClick={() => {\n            if (onEvent) {\n              const state = getState();\n\n              onEvent({\n                type: 'link-add', // TODO: add strick type for event\n                fromEntryId: state.linkEditFromEntryId,\n                toEntryId: state.linkEditToEntryId,\n                legendId: state.linkEditSelectedLegendId,\n                attributes: enteredAttribute,\n              });\n            }\n\n            dispatch({\n              type: 'end-create-link',\n              enteredAttributes: enteredAttribute,\n            });\n          }}\n          disabled={!isAddEnabled}\n        >\n          Confirm\n        </button>\n      </div>\n    </div>\n  );\n}\n\nfunction matchLinkConstraint(\n  constraint: {\n    [propertyName: string]: IConstraint;\n  },\n  fromEntry: IAnnotation,\n  toEntry: IAnnotation\n) {\n  return (\n    matchLinkConstraintEntry(constraint.parentType, fromEntry) &&\n    matchLinkConstraintEntry(constraint.childType, toEntry)\n  );\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction matchLinkConstraintEntry(entryConstraint: IConstraint, entry: any) {\n  let isMatch = true;\n\n  Object.keys(entryConstraint).forEach(propKey => {\n    const propValues = entryConstraint[propKey];\n\n    if (Array.isArray(propValues)) {\n      if (!propValues.includes(entry[propKey])) {\n        isMatch = false;\n      }\n    } else {\n      if (!matchLinkConstraintEntry(propValues, entry[propKey])) {\n        isMatch = false;\n      }\n    }\n  });\n\n  return isMatch;\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React, {useEffect, useState} from 'react';\nimport Select from 'react-select';\nimport {\n  useTextViewerDispatch,\n  useTextViewerState,\n  getState,\n} from '../contexts/text-viewer.context';\nimport style from '../styles/CreateBox.module.css';\nimport {\n  IOntology,\n  ISelectOption,\n  IEntryAttributeDefinition,\n} from '../lib/interfaces';\nimport {shortId, isEntryAnnotation} from '../lib/utils';\nimport {OnEventType} from './TextViewer';\nimport {restorePos} from '../lib/text-spacer';\n\nexport interface AnnotationCreateBoxProp {\n  cursorBegin: number | null;\n  cursorEnd: number | null;\n  ontology: IOntology;\n  onEvent?: OnEventType;\n}\n\ninterface AttrConstraint {\n  [attrName: string]: Set<string>;\n}\n\nexport default function AnnotationCreateBox({\n  cursorBegin,\n  cursorEnd,\n  ontology,\n  onEvent,\n}: AnnotationCreateBoxProp) {\n  const dispatch = useTextViewerDispatch();\n  const {annoEditSelectedLegendId} = useTextViewerState();\n  const [slideInAnimated, setSlideInAnimated] = useState(false);\n  const [flashAnimated, setFlashAnimated] = useState(false);\n  const [enteredAttribute, setEnteredAttribute] = useState<any>({});\n\n  useEffect(() => {\n    setSlideInAnimated(true);\n  }, []);\n\n  useEffect(() => {\n    setTimeout(() => {\n      setFlashAnimated(true);\n    }, 100);\n    return () => {\n      setFlashAnimated(false);\n    };\n  }, [cursorEnd]);\n\n  const legendTypeOptions = ontology.definitions\n    .filter(entry => {\n      return isEntryAnnotation(ontology, entry.entryName);\n    })\n    .map(def => {\n      return {\n        value: def.entryName,\n        label: shortId(def.entryName),\n      };\n    });\n\n  const selectedLegendDefinition = ontology.definitions.find(def => {\n    return def.entryName === annoEditSelectedLegendId;\n  });\n\n  const selectedLegendTypeOption = legendTypeOptions.find(legendType => {\n    return annoEditSelectedLegendId === legendType.value;\n  });\n\n  const isAddEnabled =\n    cursorBegin !== null && cursorEnd !== null && annoEditSelectedLegendId;\n\n  function renderAttributeSelect() {\n    if (\n      !selectedLegendDefinition ||\n      !selectedLegendDefinition.attributes ||\n      !selectedLegendDefinition.attributes.length\n    ) {\n      return null;\n    }\n\n    const legendConstraint =\n      ontology.constraints[selectedLegendDefinition.entryName] || [];\n    const attrConstraint: AttrConstraint = {};\n\n    legendConstraint.forEach(cons => {\n      Object.keys(cons.attributes || {}).forEach(attrName => {\n        const attrValues = cons.attributes[attrName] as any[];\n        attrConstraint[attrName] = attrConstraint[attrName] || new Set<any>();\n        attrValues.forEach((v: any) => attrConstraint[attrName].add(v));\n      });\n    });\n\n    return (\n      <div className={style.legend_attributes}>\n        {(selectedLegendDefinition.attributes || []).map(attr => {\n          return (\n            <div className={style.legend_attribute_item} key={attr.name}>\n              <div className={style.legend_attribute_item_title}>\n                {attr.name}\n              </div>\n\n              {renderAttributeInput(attr, attrConstraint)}\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n\n  function renderAttributeInput(\n    attr: IEntryAttributeDefinition,\n    attrConstraint: AttrConstraint\n  ) {\n    if (attrConstraint[attr.name]) {\n      const options = Array.from(attrConstraint[attr.name]).map(v => ({\n        value: v,\n        label: v,\n      }));\n\n      const selectedOption = options.find(\n        o => o.value === enteredAttribute[attr.name]\n      );\n\n      return (\n        <div>\n          <Select\n            className={style.input}\n            value={selectedOption}\n            onChange={item => {\n              setEnteredAttribute({\n                ...enteredAttribute,\n                [attr.name]: (item as ISelectOption).value,\n              });\n            }}\n            options={options}\n          />\n        </div>\n      );\n    } else {\n      return (\n        <div>\n          <input\n            type=\"text\"\n            className={style.input}\n            value={enteredAttribute[attr.name] || ''}\n            onChange={e =>\n              setEnteredAttribute({\n                ...enteredAttribute,\n                [attr.name]: e.target.value,\n              })\n            }\n          />\n        </div>\n      );\n    }\n  }\n\n  return (\n    <div\n      className={`${style.create_box}\n      ${slideInAnimated && style.slide_in_animated}`}\n    >\n      <div className={style.create_entry_container}>\n        <div className={style.create_title}>Begin</div>\n        <div className={style.create_id}>\n          {cursorBegin !== null ? cursorBegin : ''}\n        </div>\n      </div>\n\n      <div\n        className={`${style.create_entry_container}\n          ${\n            flashAnimated ? style.flash_animated_on : style.flash_animated_off\n          }`}\n      >\n        <div className={style.create_title}>End</div>\n        <div\n          className={`${style.create_id}\n          ${cursorEnd === null && style.to_be_select}`}\n        >\n          {cursorEnd !== null ? cursorEnd : '[Click text to select end]'}\n        </div>\n      </div>\n\n      <div className={style.legend_type_container}>\n        <div className={style.legend_type_title}>Legend Type</div>\n        <Select\n          value={selectedLegendTypeOption}\n          onChange={item => {\n            const selectedItem = item as ISelectOption;\n            dispatch({\n              type: 'annotation-edit-select-legend-type',\n              legendId: selectedItem.value,\n            });\n          }}\n          options={legendTypeOptions}\n        />\n      </div>\n\n      {renderAttributeSelect()}\n\n      <div className={style.buttons}>\n        <button\n          onClick={() => {\n            dispatch({\n              type: 'annotation-edit-cancel',\n            });\n          }}\n        >\n          Cancel\n        </button>\n        <button\n          onClick={() => {\n            if (onEvent) {\n              const state = getState();\n\n              if (\n                state.annoEditCursorBegin === null ||\n                state.annoEditCursorEnd === null ||\n                state.annoEditSelectedLegendId === null\n              ) {\n                throw new Error(\n                  'cannot create annotation with no begin or end cursor selected'\n                );\n              }\n\n              const [actualBegin, actualEnd] = restorePos(\n                state.charMoveMap,\n                state.annoEditCursorBegin,\n                state.annoEditCursorEnd\n              );\n\n              onEvent({\n                type: 'annotation-add', // TODO: add strick type for event\n                span: {\n                  begin: actualBegin,\n                  end: actualEnd,\n                },\n                legendId: state.annoEditSelectedLegendId,\n                attributes: enteredAttribute,\n              });\n            }\n\n            dispatch({\n              type: 'annotation-edit-submit',\n            });\n          }}\n          disabled={!isAddEnabled}\n        >\n          Confirm\n        </button>\n      </div>\n    </div>\n  );\n}\n","import React from 'react';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport CheckBoxOutlineBlankIcon from '@material-ui/icons/CheckBoxOutlineBlank';\nimport CheckBoxIcon from '@material-ui/icons/CheckBox';\nimport Pagination from '@material-ui/lab/Pagination';\nimport Tab from './Tab';\nimport style from '../styles/TextViewer.module.css';\nimport {\n  IAnnotation,\n  IPlugin,\n  IProjectConfigs,\n  IDocuments,\n} from '../lib/interfaces';\nimport {\n  applyColorToLegend,\n  isEntryAnnotation,\n  isEntryLink,\n  isAvailableLegend,\n} from '../lib/utils';\nimport AnnotationDetail from './AnnotationDetail';\nimport LinkDetail from './LinkDetail';\nimport TextDetail from './TextDetail';\nimport TextArea from './TextArea';\nimport ScopeSelector from './ScopeSelector';\nimport {\n  useTextViewerState,\n  useTextViewerDispatch,\n} from '../contexts/text-viewer.context';\nimport LinkCreateBox from './LinkCreateBox';\nimport AnnotationCreateBox from './AnnotationCreateBox';\nimport {FormControlLabel} from '@material-ui/core';\nimport { NLPViewerOptions } from '..';\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type OnEventType = (event: any) => void;\n\nexport interface TextViewerProp {\n  plugins: IPlugin[];\n  onEvent?: OnEventType;\n  projectConfig: IProjectConfigs;\n  documents: IDocuments;\n  options?: NLPViewerOptions;\n}\n\nfunction TextViewer({\n  plugins,\n  onEvent,\n  projectConfig,\n  documents,\n  options\n}: TextViewerProp) {\n  const appState = useTextViewerState();\n  const dispatch = useTextViewerDispatch();\n\n  const {\n    textPack,\n    ontology,\n\n    selectedAnnotationId,\n    selectedLinkId,\n\n    linkEditFromEntryId,\n    linkEditToEntryId,\n    linkEditIsCreating,\n\n    annoEditIsCreating,\n    annoEditCursorBegin,\n    annoEditCursorEnd,\n\n    selectedScopeId,\n    selectedScopeIndex,\n  } = appState;\n  if (!textPack || !ontology || !projectConfig) return null;\n\n  const doc_id = window.location.pathname.split('/').pop()!;\n\n  const {annotations, links, attributes} = textPack;\n\n  const annotationLegendsWithColor = applyColorToLegend(\n    ontology.definitions.filter(\n      entry =>\n        isEntryAnnotation(ontology, entry.entryName) &&\n        isAvailableLegend(projectConfig['legendConfigs'], entry.entryName)\n    )\n  );\n  const linksLegendsWithColor = applyColorToLegend(\n    ontology.definitions.filter(\n      entry =>\n        isEntryLink(ontology, entry.entryName) &&\n        isAvailableLegend(projectConfig['legendConfigs'], entry.entryName)\n    )\n  );\n\n  const selectedAnnotation =\n    annotations.find(ann => ann.id === selectedAnnotationId) || null;\n  const selectedAnnotationParents: IAnnotation[] = [];\n  const selectedAnnotationChildren: IAnnotation[] = [];\n\n  links.forEach(link => {\n    if (link.fromEntryId === selectedAnnotationId) {\n      const anno = annotations.find(ann => ann.id === link.toEntryId);\n      if (anno) selectedAnnotationChildren.push(anno);\n    } else if (link.toEntryId === selectedAnnotationId) {\n      const anno = annotations.find(ann => ann.id === link.fromEntryId);\n      if (anno) selectedAnnotationParents.push(anno);\n    }\n  });\n\n  const selectedLink = links.find(link => link.id === selectedLinkId) || null;\n  const enabledPlugins = plugins.filter(p => p.enabled(appState));\n\n  const pluginsByName = new Map<string, IPlugin>(\n    enabledPlugins.map(p => [p.name, p])\n  );\n\n  function renderPlugin(p: IPlugin) {\n    const Comp = p.component;\n    return (\n      <Comp key={'plugin_' + p.name} dispatch={dispatch} appState={appState} />\n    );\n  }\n\n  function renderPluginByName(name: string) {\n    if (pluginsByName.has(name)) {\n      const p = pluginsByName.get(name);\n      if (typeof p !== 'undefined') {\n        return renderPlugin(p);\n      }\n    }\n    return null;\n  }\n\n  function renderAllPlugin() {\n    console.log('Rendering all plugins');\n    if (enabledPlugins.length === 0) {\n      return (\n        <div className={style.plugins_container}>No Plugins Configured.</div>\n      );\n    } else if (enabledPlugins.length > 0) {\n      const tabList = enabledPlugins.map(p => {\n        return {\n          title: p.name,\n          body: () => renderPlugin(p),\n        };\n      });\n\n      return (\n        <div className={style.plugins_container}>\n          <Tab tabs={tabList} activeTabIndex={0}></Tab>\n        </div>\n      );\n    }\n    return null;\n  }\n\n  function customRender(areaName: string) {\n    // Rendering based on customized layout setup.\n\n    // Disable this area\n    if (projectConfig['layoutConfigs'][areaName] === 'disable') {\n      return null;\n    }\n\n    // Render Plugins.\n    if (projectConfig['layoutConfigs'][areaName] === 'plugins') {\n      return renderAllPlugin();\n    }\n\n    if (pluginsByName.has(projectConfig['layoutConfigs'][areaName])) {\n      return renderPluginByName(projectConfig['layoutConfigs'][areaName]);\n    }\n\n    return <span>Invalid component</span>;\n  }\n\n  function MiddleCenterArea() {\n    const areaName = 'center-middle';\n    if (\n      typeof projectConfig['layoutConfigs'][areaName] === 'undefined' ||\n      projectConfig['layoutConfigs'][areaName] === 'default-nlp'\n    ) {\n      if (textPack) {\n        return (\n          <TextArea\n            textPack={textPack}\n            annotationLegendsColored={annotationLegendsWithColor}\n          />\n        );\n      }\n    }\n\n    return customRender(areaName);\n  }\n\n  function MiddleBottomArea() {\n    const areaName = 'center-bottom';\n    return customRender(areaName);\n  }\n\n  function LeftArea() {\n    const areaName = 'left';\n\n    if (\n      typeof projectConfig['layoutConfigs'][areaName] === 'undefined' ||\n      projectConfig['layoutConfigs'][areaName] === 'default-meta'\n    ) {\n      if (textPack && ontology) {\n        return (\n          <div className={style.metadata_side_container}>\n            <h1 className={style.anno_legends_heading}>Annotation Legends</h1>\n            <div className={style.anno_legends_sub}>\n              <p>\n                See the summary visualiations of annotations and explore them\n                in-situ.\n                <br /> Select edit to change them.\n              </p>\n            </div>\n            {(options && options.allowEditAnnotations) &&  (\n              <div className={style.add_annotation_container}>\n                <FormControlLabel\n                  control={\n                    <Checkbox\n                      icon={<CheckBoxOutlineBlankIcon fontSize=\"small\" />}\n                      checkedIcon={\n                        <CheckBoxIcon fontSize=\"small\" htmlColor=\"#246ED6\" />\n                      }\n                      size=\"small\"\n                      checked={annoEditIsCreating}\n                      onChange={() => {\n                        dispatch({\n                          type: annoEditIsCreating\n                            ? 'exit-annotation-edit'\n                            : 'start-annotation-edit',\n                        });\n                      }}\n                      inputProps={{'aria-label': 'Edit annotations checkbox'}}\n                    />\n                  }\n                  label=\"Edit annotations\"\n                />\n                {annoEditIsCreating && (\n                  <div className={style.button_action_description}>\n                    select text to add annotation\n                  </div>\n                )}\n              </div>\n            )}\n            <TextDetail\n              annotationLegends={annotationLegendsWithColor}\n              linkLegends={linksLegendsWithColor}\n              attributes={attributes}\n            />\n          </div>\n        );\n      }\n    }\n    return customRender(areaName);\n  }\n\n  function RightArea() {\n    const areaName = 'right';\n\n    if (\n      typeof projectConfig['layoutConfigs'][areaName] === 'undefined' ||\n      projectConfig['layoutConfigs'][areaName] === 'default-attribute'\n    ) {\n      if (textPack && ontology) {\n        return (\n          <div className={style.attributes_side_container}>\n            {linkEditIsCreating && (\n              <div>\n                <h2>Create Link</h2>\n                <LinkCreateBox\n                  fromEntryId={linkEditFromEntryId}\n                  toEntryId={linkEditToEntryId}\n                  ontology={ontology}\n                  onEvent={onEvent}\n                />\n              </div>\n            )}\n\n            {annoEditIsCreating && annoEditCursorBegin !== null && (\n              <div className={style.link_edit_container}>\n                <AnnotationCreateBox\n                  cursorBegin={annoEditCursorBegin}\n                  cursorEnd={annoEditCursorEnd}\n                  ontology={ontology}\n                  onEvent={onEvent}\n                />\n              </div>\n            )}\n\n            {selectedLink && (\n              <div>\n                <h2>Link Attributes</h2>\n                <LinkDetail link={selectedLink} onEvent={onEvent} />\n              </div>\n            )}\n\n            {selectedAnnotation && (\n              <div>\n                <h2>Annotation Attributes</h2>\n                <AnnotationDetail\n                  parentAnnotations={selectedAnnotationParents}\n                  childAnnotations={selectedAnnotationChildren}\n                  annotation={selectedAnnotation}\n                  onEvent={onEvent}\n                />\n              </div>\n            )}\n          </div>\n        );\n      }\n    }\n\n    return customRender(areaName);\n  }\n\n  function ToolBar() {\n    let scopeCount = 0;\n    const isFullText = selectedScopeId === null && documents !== null;\n    let paginationIndex = selectedScopeIndex;\n    if (isFullText) {\n      scopeCount = documents.documents.length;\n      paginationIndex = documents.documents.findIndex(\n        x => x.id === parseInt(doc_id)\n      );\n    } else if (textPack) {\n      scopeCount = textPack.annotations.filter(\n        ann => ann.legendId === selectedScopeId\n      ).length;\n    }\n    const handlePageChange = (\n      event: React.ChangeEvent<unknown>,\n      value: number\n    ) => {\n      if (value - 1 === paginationIndex) {\n        return;\n      } else {\n        if (isFullText) {\n          // The scope selected is set to Full Text, so paginate through project's documents\n          window.location.href = `/documents/${\n            documents.documents[value - 1].id\n          }`;\n        } else {\n          // Scope selector was set to a scope other than Full text\n          dispatch({type: 'set-scope-index', scopeIndex: value - 1});\n        }\n      }\n    };\n\n    if (\n      typeof projectConfig['layoutConfigs']['center-middle'] === 'undefined' ||\n      projectConfig['layoutConfigs']['center-middle'] === 'default-nlp'\n    ) {\n      if (textPack && ontology && projectConfig) {\n        return (\n          <div className={style.tool_bar_container}>\n            <div className={style.scope_selector_container}>\n              <ScopeSelector\n                ontology={ontology}\n                selectedScopeId={selectedScopeId}\n                scopeConfig={projectConfig.scopeConfigs}\n              />\n\n              {(selectedScopeId !== null ||\n                (selectedScopeId === null &&\n                  documents &&\n                  documents.documents.length > 1)) && (\n                <div className={style.scope_nav_container}>\n                  <Pagination\n                    page={paginationIndex + 1}\n                    onChange={handlePageChange}\n                    count={scopeCount}\n                    defaultPage={1}\n                    variant=\"outlined\"\n                    shape=\"rounded\"\n                  />\n                </div>\n              )}\n            </div>\n          </div>\n        );\n      }\n    }\n    if (projectConfig['layoutConfigs']['center-middle'] === 'example') {\n      return <span>Example component</span>;\n    }\n    return <div></div>;\n  }\n\n  return (\n    <div className={style.text_viewer}>\n      <main className={style.layout_container}>\n        {LeftArea()}\n        <div\n          className={`${style.center_area_container}\n              ${annoEditIsCreating && style.is_adding_annotation}`}\n        >\n          {((options && options.enableScopeSelector) && (<ToolBar />) )}\n          <div className={`${style.text_area_container}`}>\n            {MiddleCenterArea()}\n          </div>\n          {MiddleBottomArea()}\n        </div>\n        {RightArea()}\n      </main>\n    </div>\n  );\n}\n\nexport default TextViewer;\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {colorPalettes} from './color';\n\nconst labels: any = {};\nconst colorIterator = createColorIterator();\n\n(window as any).ll = ll;\nexport function ll(label: string, ...values: any[]) {\n  let color = '';\n  if (labels[label]) {\n    color = labels[label];\n  } else {\n    labels[label] = colorIterator.next();\n    color = labels[label];\n  }\n\n  console.log(`%c ${label} `, `background: ${color}; color: white;`, ...values);\n}\n\nfunction createColorIterator() {\n  let colorIndex = -1;\n\n  return {\n    next() {\n      colorIndex++;\n      return colorPalettes[colorIndex % colorPalettes.length];\n    },\n  };\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  ISinglePack,\n  IOntology,\n  IAnnotation,\n  ILink,\n  IProjectConfigs,\n  IDocuments,\n} from './interfaces';\nimport {isEntryAnnotation, isEntryLink, camelCaseDeep} from './utils';\n\ninterface APIDoc {\n  id: number;\n  name: string;\n}\nexport function transformPack(\n  rawPack: string,\n  rawOntology: string\n): [ISinglePack, IOntology] {\n  const data = JSON.parse(rawPack);\n  const config = JSON.parse(rawOntology);\n\n  const packData = data['py/state'];\n  const annotations = packData.annotations.filter((a: any) => !!a['py/state']);\n\n  const configTransformed = {\n    constraints: [],\n    ...camelCaseDeep(config),\n  };\n\n  const formatedAnnotations = annotations\n    .map((a: any) => {\n      const legendName = getLegendName(a);\n\n      return {\n        span: {\n          begin: a['py/state']._span.begin,\n          end: a['py/state']._span.end,\n        },\n        id: a['py/state']._tid + '',\n        legendId: legendName,\n        attributes: getAttrs(configTransformed, a),\n      };\n    })\n    .filter(Boolean);\n\n  const links = packData.links\n    .map((link: any) => {\n      const legendName = getLegendName(link);\n\n      return {\n        id: link['py/state']._tid + '',\n        fromEntryId: link['py/state']._parent + '',\n        toEntryId: link['py/state']._child + '',\n        legendId: legendName,\n        attributes: getAttrs(configTransformed, link),\n      };\n    })\n    .filter(Boolean);\n\n  const groups = packData.groups.map((group: any) => {\n    const legendName = getLegendName(group);\n\n    return {\n      id: group['py/state']._tid + '',\n      members: group['py/state']['_members']['py/set'].map((i: any) => i + ''),\n      memberType: getGroupType(legendName, configTransformed),\n      legendId: legendName,\n      attributes: getAttrs(configTransformed, group),\n    };\n  });\n\n  const pack = {\n    text: packData._text,\n    annotations: formatedAnnotations,\n    links: links,\n    groups: groups,\n    attributes:\n      // Backward compatibility with Forte formats.\n      'meta' in packData\n        ? packData.meta['py/state']\n        : packData._meta['py/state'],\n  };\n\n  return [pack, configTransformed] as any;\n}\n\nfunction getLegendName(a: any) {\n  return a['py/object'];\n}\n\nfunction getAttrs(config: any, a: any) {\n  const legendName = getLegendName(a);\n\n  const legend = config['definitions'].find(\n    (entry: any) => entry.entryName === legendName\n  );\n\n  if (!legend || !legend.attributes) {\n    return {};\n  }\n\n  const attrNames = legend.attributes.map((a: any) => a.name);\n  const attrs: any = {};\n\n  Object.keys(a['py/state']).forEach(key => {\n    if (attrNames.includes(key)) {\n      attrs[key] = a['py/state'][key];\n    }\n  });\n\n  return attrs;\n}\n\nfunction getGroupType(groupEntryName: any, config: any) {\n  const entry = config.definitions.find(\n    (ent: any) => ent.entryName === groupEntryName\n  );\n\n  if (isEntryAnnotation(config, entry.memberType)) {\n    return 'annotation';\n  } else if (isEntryLink(config, entry.memberType)) {\n    return 'link';\n  } else {\n    throw new Error('unknown group entry ' + groupEntryName);\n  }\n}\n\nexport function transformBackAnnotation(annotation: IAnnotation): any {\n  return {\n    'py/object': annotation.legendId,\n    'py/state': {\n      _span: {\n        begin: annotation.span.begin,\n        end: annotation.span.end,\n        'py/object': 'forte.data.span.Span',\n      },\n      _tid: annotation.id,\n      ...annotation.attributes,\n    },\n  };\n}\n\nexport function transformBackLink(link: ILink): any {\n  return {\n    'py/object': link.legendId,\n    'py/state': {\n      _child: link.toEntryId,\n      _parent: link.toEntryId,\n      _tid: link.id,\n      ...link.attributes,\n    },\n  };\n}\n\nexport function transformProjectConfig(rawConfig: string): IProjectConfigs {\n  const config = JSON.parse(rawConfig);\n  return {\n    legendConfigs: config ? config.legendConfigs : {},\n    scopeConfigs: config ? config.scopeConfigs : {},\n    layoutConfigs: config ? config.layoutConfigs : {},\n  };\n}\n\nexport function transformDocs(docs: APIDoc[]): IDocuments {\n  return {\n    documents: docs.map(doc => {\n      return {\n        id: doc.id,\n        name: doc.name,\n      };\n    }),\n  };\n}\n","import React, {useEffect} from 'react';\nimport TextViewer, {OnEventType} from './components/TextViewer';\nimport {\n  TextViewerProvider,\n  useTextViewerDispatch,\n} from './contexts/text-viewer.context';\n\nimport './lib/log';\nimport './styles/normalize.css';\nimport './styles/global.css';\nimport {\n  ISinglePack,\n  IOntology,\n  IPlugin,\n  IProjectConfigs,\n  IDocuments,\n} from './lib/interfaces';\n\nexport * from './lib/transform';\nexport * from './lib/interfaces';\nexport * from './contexts/text-viewer.context';\n\nexport interface NLPViewerOptions {\n  allowEditAnnotations: Boolean; // TODO: document\n  enableScopeSelector: Boolean;\n}\nexport interface NLPViewerProp {\n  textPack: ISinglePack;\n  ontology: IOntology;\n  plugins: IPlugin[];\n  projectConfig: IProjectConfigs;\n  documents: IDocuments;\n  onEvent?: OnEventType;\n  options?: NLPViewerOptions;\n}\n\nexport default function NLPViewer(props: NLPViewerProp) {\n  return (\n    <TextViewerProvider>\n      <TextViewerFetchContainer {...props} />;\n    </TextViewerProvider>\n  );\n}\n\nfunction TextViewerFetchContainer(props: NLPViewerProp) {\n  const dispatch = useTextViewerDispatch();\n\n  useEffect(() => {\n    dispatch({\n      type: 'set-text-pack',\n      textPack: props.textPack,\n    });\n\n    dispatch({\n      type: 'set-ontology',\n      ontology: props.ontology,\n    });\n  }, [dispatch, props.textPack, props.ontology]);\n\n  return (\n    <TextViewer\n      plugins={props.plugins}\n      onEvent={props.onEvent}\n      projectConfig={props.projectConfig}\n      documents={props.documents}\n      options={props.options}\n    />\n  );\n}\n"],"names":["useState","React","style","calculateLinesLevels","shouldMultiLineGoLeft","createContext","useReducer","useContext","IconButton","MoreVertIcon","withStyles","Tooltip","InfoIcon","memo","lineMaskWidth","lineMaskColor","textLinkDistance","borderRadius","useEffect","useRef","debounce","useMemo","Annotation","AnnotationLabel","LinkSingleLine","LinkMultiLine","LinkEditConnector","Select","FormControlLabel","Checkbox","CheckBoxOutlineBlankIcon","CheckBoxIcon","Pagination"],"mappings":"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"}